import os
import json
import sqlite3
import logging
import asyncio
import random
import re
from datetime import datetime, timedelta
import threading
import time
import hashlib
import uuid
import subprocess
import sys

# ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù„Ù„Ø¹Ù…Ù„ Ø¹Ù„Ù‰ Replit
def install_requirements():
    """ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©"""
    packages = ['python-telegram-bot', 'nest-asyncio', 'requests']
    for package in packages:
        try:
            subprocess.check_call([sys.executable, "-m", "pip", "install", package], 
                                stdout=subprocess.DEVNULL, stderr=subprocess.DEVNULL)
        except:
            pass

# ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª
install_requirements()

# Ø§Ø³ØªÙŠØ±Ø§Ø¯ nest_asyncio Ù„Ø­Ù„ Ù…Ø´Ø§ÙƒÙ„ event loop
try:
    import nest_asyncio
    nest_asyncio.apply()
except ImportError:
    subprocess.check_call([sys.executable, "-m", "pip", "install", "nest_asyncio"])
    import nest_asyncio
    nest_asyncio.apply()

# Ø§Ø³ØªÙŠØ±Ø§Ø¯ telegram Ø¨Ø¹Ø¯ Ø§Ù„ØªØ«Ø¨ÙŠØª
from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup, Bot
from telegram.ext import Application, CommandHandler, CallbackQueryHandler, MessageHandler, filters, ContextTypes

# Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…
logging.basicConfig(
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s', 
    level=logging.INFO,
    handlers=[
        logging.FileHandler('mental_health_advanced.log'),
        logging.StreamHandler()
    ]
)
logger = logging.getLogger(__name__)

# Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¨ÙˆØª
TOKEN = os.getenv("TELEGRAM_BOT_TOKEN", "8003913696:AAFzWOmJIBA5lGA3ezQV1_DcLMcCbIZo86s")
CHANNEL_ID = os.getenv("TELEGRAM_CHANNEL_ID", "@your_channel_username")

# Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ù…Ø¹Ø±ÙØ© Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ© ÙˆØ§Ù„ÙÙ„Ø³ÙÙŠØ© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©
KNOWLEDGE_DATABASE = {
    'depression': {
        'quran': {
            'ayah': "ï´¿ÙˆÙÙ„ÙØ§ ØªÙÙŠÙ’Ø£ÙØ³ÙÙˆØ§ Ù…ÙÙ† Ø±ÙÙ‘ÙˆÙ’Ø­Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Û– Ø¥ÙÙ†ÙÙ‘Ù‡Ù Ù„ÙØ§ ÙŠÙÙŠÙ’Ø£ÙØ³Ù Ù…ÙÙ† Ø±ÙÙ‘ÙˆÙ’Ø­Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø¥ÙÙ„ÙÙ‘Ø§ Ø§Ù„Ù’Ù‚ÙÙˆÙ’Ù…Ù Ø§Ù„Ù’ÙƒÙØ§ÙÙØ±ÙÙˆÙ†Ùï´¾",
            'reference': "[ÙŠÙˆØ³Ù:87]",
            'tafseer': "Ø§Ù„Ù†Ù‡ÙŠ Ø¹Ù† Ø§Ù„ÙŠØ£Ø³ ÙˆØ§Ù„Ø¥Ø­Ø¨Ø§Ø·ØŒ ÙØ¥Ù† Ø±Ø­Ù…Ø© Ø§Ù„Ù„Ù‡ ÙˆØ§Ø³Ø¹Ø©"
        },
        'hadith': {
            'text': "Ø¹ÙØ¬ÙØ¨Ù‹Ø§ Ù„ÙØ£ÙÙ…Ù’Ø±Ù Ø§Ù„Ù’Ù…ÙØ¤Ù’Ù…ÙÙ†ÙØŒ Ø¥ÙÙ†ÙÙ‘ Ø£ÙÙ…Ù’Ø±ÙÙ‡Ù ÙƒÙÙ„ÙÙ‘Ù‡Ù Ø®ÙÙŠÙ’Ø±ÙŒ",
            'source': "Ø±ÙˆØ§Ù‡ Ù…Ø³Ù„Ù…",
            'meaning': "ÙƒÙ„ Ù…Ø§ ÙŠØµÙŠØ¨ Ø§Ù„Ù…Ø¤Ù…Ù† ÙÙŠÙ‡ Ø®ÙŠØ± Ù„Ù‡"
        },
        'philosophers': {
            'stoicism': "ÙÙŠ Ø§Ù„ÙÙ„Ø³ÙØ© Ø§Ù„Ø±ÙˆØ§Ù‚ÙŠØ©ØŒ Ø§Ù„Ø§ÙƒØªØ¦Ø§Ø¨ Ù†ØªÙŠØ¬Ø© Ù„Ù…Ù‚Ø§ÙˆÙ…Ø© Ù…Ø§ Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØºÙŠÙŠØ±Ù‡",
            'viktor_frankl': "ÙŠÙ…ÙƒÙ† Ù„Ù„Ø¥Ù†Ø³Ø§Ù† Ø£Ù† ÙŠØªØ­Ù…Ù„ Ø£ÙŠ Ù…Ø¹Ø§Ù†Ø§Ø© Ø¥Ø°Ø§ ÙˆØ¬Ø¯ Ù…Ø¹Ù†Ù‰ Ù„Ù‡Ø§",
            'cognitive_therapy': "Ø§Ù„Ø£ÙÙƒØ§Ø± Ø§Ù„Ø³Ù„Ø¨ÙŠØ© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ù‡ÙŠ Ø§Ù„Ø³Ø¨Ø¨ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„Ù„Ø§ÙƒØªØ¦Ø§Ø¨"
        }
    },
    'anxiety': {
        'quran': {
            'ayah': "ï´¿Ø§Ù„ÙÙ‘Ø°ÙÙŠÙ†Ù Ø¢Ù…ÙÙ†ÙÙˆØ§ ÙˆÙØªÙØ·Ù’Ù…ÙØ¦ÙÙ†ÙÙ‘ Ù‚ÙÙ„ÙÙˆØ¨ÙÙ‡ÙÙ… Ø¨ÙØ°ÙÙƒÙ’Ø±Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Û— Ø£ÙÙ„ÙØ§ Ø¨ÙØ°ÙÙƒÙ’Ø±Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù ØªÙØ·Ù’Ù…ÙØ¦ÙÙ†ÙÙ‘ Ø§Ù„Ù’Ù‚ÙÙ„ÙÙˆØ¨Ùï´¾",
            'reference': "[Ø§Ù„Ø±Ø¹Ø¯:28]",
            'tafseer': "Ø°ÙƒØ± Ø§Ù„Ù„Ù‡ ÙŠØ¬Ù„Ø¨ Ø§Ù„Ø·Ù…Ø£Ù†ÙŠÙ†Ø© ÙˆØ§Ù„Ø³ÙƒÙŠÙ†Ø© Ù„Ù„Ù‚Ù„Ø¨"
        },
        'hadith': {
            'text': "Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø¥ÙÙ†ÙÙ‘ÙŠ Ø£ÙØ¹ÙÙˆØ°Ù Ø¨ÙÙƒÙ Ù…ÙÙ†Ù Ø§Ù„Ù’Ù‡ÙÙ…ÙÙ‘ ÙˆÙØ§Ù„Ù’Ø­ÙØ²ÙÙ†Ù",
            'source': "Ø±ÙˆØ§Ù‡ Ø§Ù„Ø¨Ø®Ø§Ø±ÙŠ",
            'meaning': "Ø¯Ø¹Ø§Ø¡ Ù„Ù„ØªØ®Ù„Øµ Ù…Ù† Ø§Ù„Ù‚Ù„Ù‚ ÙˆØ§Ù„Ø­Ø²Ù†"
        },
        'philosophers': {
            'epictetus': "Ø£Ù†Øª ØªØªØ¶Ø§ÙŠÙ‚ Ù„ÙŠØ³ Ù…Ù† Ø§Ù„Ø£Ø­Ø¯Ø§Ø«ØŒ Ø¨Ù„ Ù…Ù† Ø±Ø£ÙŠÙƒ ÙÙŠÙ‡Ø§",
            'mindfulness': "Ø§Ù„Ù‚Ù„Ù‚ ÙŠØ£ØªÙŠ Ù…Ù† Ø§Ù„Ø¹ÙŠØ´ ÙÙŠ Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ØŒ Ø§Ù„Ø¹ÙŠØ´ ÙÙŠ Ø§Ù„Ø­Ø§Ø¶Ø± ÙŠØ¬Ù„Ø¨ Ø§Ù„Ø³Ù„Ø§Ù…",
            'cbt': "ØªØ­Ø¯ÙŠ Ø§Ù„Ø£ÙÙƒØ§Ø± Ø§Ù„ÙƒØ§Ø±Ø«ÙŠØ© ÙŠÙ‚Ù„Ù„ Ù…Ù† Ø§Ù„Ù‚Ù„Ù‚ Ø¨Ø´ÙƒÙ„ ÙƒØ¨ÙŠØ±"
        }
    }
}

# Ø§Ø®ØªØ¨Ø§Ø± ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø´Ø®ØµÙŠØ© MBTI
MBTI_ASSESSMENT = {
    'name': 'Ø§Ø®ØªØ¨Ø§Ø± ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø´Ø®ØµÙŠØ© Ù…Ø§ÙŠØ±Ø²-Ø¨Ø±ÙŠØºØ² (MBTI)',
    'description': 'ØªØ­Ù„ÙŠÙ„ Ø´Ø§Ù…Ù„ Ù„Ù„Ø´Ø®ØµÙŠØ© ÙˆÙÙ‚Ø§Ù‹ Ù„Ù…Ø¤Ø´Ø± Ù…Ø§ÙŠØ±Ø²-Ø¨Ø±ÙŠØºØ² Ø§Ù„Ù…Ø¹ØªÙ…Ø¯ Ø¹Ø§Ù„Ù…ÙŠØ§Ù‹',
    'icon': 'ğŸ§ ',
    'dimensions': {
        'EI': {
            'name': 'Ø§Ù„Ø§Ù†ÙØªØ§Ø­ Ù…Ù‚Ø§Ø¨Ù„ Ø§Ù„Ø§Ù†Ø·ÙˆØ§Ø¡',
            'description': 'ÙƒÙŠÙ ØªØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø§Ù„Ø¹Ø§Ù„Ù… ÙˆØªØ³ØªÙ…Ø¯ Ø·Ø§Ù‚ØªÙƒ',
            'questions': [
                {
                    'text': 'Ø£ÙŠÙ† ØªØ´Ø¹Ø± Ø¨Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ø·Ø§Ù‚Ø© ÙˆØ§Ù„Ø­ÙŠÙˆÙŠØ©ØŸ',
                    'options': [
                        {'text': 'ÙÙŠ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª ÙˆØ§Ù„Ø£Ù†Ø´Ø·Ø© Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©', 'weight': 'E'},
                        {'text': 'ÙÙŠ Ø§Ù„Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ù‡Ø§Ø¯Ø¦Ø© ÙˆØ§Ù„Ø£Ù†Ø´Ø·Ø© Ø§Ù„ÙØ±Ø¯ÙŠØ©', 'weight': 'I'}
                    ]
                },
                {
                    'text': 'Ø¹Ù†Ø¯Ù…Ø§ ØªÙˆØ§Ø¬Ù‡ Ù…Ø´ÙƒÙ„Ø©ØŒ Ù…Ø§Ø°Ø§ ØªÙØ¹Ù„ Ø£ÙˆÙ„Ø§Ù‹ØŸ',
                    'options': [
                        {'text': 'Ø£ØªØ­Ø¯Ø« Ù…Ø¹ Ø§Ù„Ø¢Ø®Ø±ÙŠÙ† Ù„Ø£Ø®Ø° Ø¢Ø±Ø§Ø¦Ù‡Ù…', 'weight': 'E'},
                        {'text': 'Ø£ÙÙƒØ± ÙÙŠÙ‡Ø§ Ø¨Ù†ÙØ³ÙŠ Ø£ÙˆÙ„Ø§Ù‹', 'weight': 'I'}
                    ]
                },
                {
                    'text': 'ÙÙŠ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø§Øª Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©:',
                    'options': [
                        {'text': 'Ø£ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø£ÙƒØ¨Ø± Ø¹Ø¯Ø¯ Ù…Ù† Ø§Ù„Ù†Ø§Ø³', 'weight': 'E'},
                        {'text': 'Ø£Ø±ÙƒØ² Ø¹Ù„Ù‰ Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ø¹Ù…ÙŠÙ‚Ø© Ù…Ø¹ Ù‚Ù„Ø© Ù…Ù† Ø§Ù„Ø£Ø´Ø®Ø§Øµ', 'weight': 'I'}
                    ]
                }
            ]
        },
        'SN': {
            'name': 'Ø§Ù„Ø­Ø³ Ù…Ù‚Ø§Ø¨Ù„ Ø§Ù„Ø­Ø¯Ø³',
            'description': 'ÙƒÙŠÙ ØªØ¬Ù…Ø¹ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ÙˆØªÙÙ‡Ù… Ø§Ù„Ø¹Ø§Ù„Ù…',
            'questions': [
                {
                    'text': 'Ø¹Ù†Ø¯ ØªØ¹Ù„Ù… Ø´ÙŠØ¡ Ø¬Ø¯ÙŠØ¯ØŒ ØªÙØ¶Ù„:',
                    'options': [
                        {'text': 'Ø§Ù„ØªÙØ§ØµÙŠÙ„ ÙˆØ§Ù„Ø­Ù‚Ø§Ø¦Ù‚ Ø§Ù„Ù…Ù„Ù…ÙˆØ³Ø©', 'weight': 'S'},
                        {'text': 'Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„ÙƒØ¨ÙŠØ±Ø© ÙˆØ§Ù„Ø¥Ù…ÙƒØ§Ù†ÙŠØ§Øª', 'weight': 'N'}
                    ]
                },
                {
                    'text': 'Ø¹Ù†Ø¯Ù…Ø§ ØªØ­ÙƒÙŠ Ù‚ØµØ©:',
                    'options': [
                        {'text': 'ØªØ±ÙƒØ² Ø¹Ù„Ù‰ Ø§Ù„ØªÙØ§ØµÙŠÙ„ ÙˆØ§Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„ÙØ¹Ù„ÙŠØ©', 'weight': 'S'},
                        {'text': 'ØªØ±ÙƒØ² Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¹Ù†Ù‰ ÙˆØ§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø¹Ø§Ù…Ø©', 'weight': 'N'}
                    ]
                },
                {
                    'text': 'ØªØ«Ù‚ Ø£ÙƒØ«Ø± ÙÙŠ:',
                    'options': [
                        {'text': 'Ø§Ù„ØªØ¬Ø±Ø¨Ø© ÙˆØ§Ù„Ø®Ø¨Ø±Ø© Ø§Ù„Ø¹Ù…Ù„ÙŠØ©', 'weight': 'S'},
                        {'text': 'Ø§Ù„Ø­Ø¯Ø³ ÙˆØ§Ù„Ø¥Ù„Ù‡Ø§Ù…', 'weight': 'N'}
                    ]
                }
            ]
        },
        'TF': {
            'name': 'Ø§Ù„ØªÙÙƒÙŠØ± Ù…Ù‚Ø§Ø¨Ù„ Ø§Ù„Ù…Ø´Ø§Ø¹Ø±',
            'description': 'ÙƒÙŠÙ ØªØªØ®Ø° Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª',
            'questions': [
                {
                    'text': 'Ø¹Ù†Ø¯ Ø§ØªØ®Ø§Ø° Ù‚Ø±Ø§Ø± Ù…Ù‡Ù…:',
                    'options': [
                        {'text': 'ØªØ­Ù„Ù„ Ø§Ù„Ù…Ù†Ø·Ù‚ ÙˆØ§Ù„Ø­Ù‚Ø§Ø¦Ù‚', 'weight': 'T'},
                        {'text': 'ØªØ£Ø®Ø° ÙÙŠ Ø§Ù„Ø§Ø¹ØªØ¨Ø§Ø± ØªØ£Ø«ÙŠØ±Ù‡ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø´Ø®Ø§Øµ', 'weight': 'F'}
                    ]
                },
                {
                    'text': 'ÙŠØ±Ø§Ùƒ Ø§Ù„Ø¢Ø®Ø±ÙˆÙ† ÙƒØ´Ø®Øµ:',
                    'options': [
                        {'text': 'Ø¹Ø§Ø¯Ù„ ÙˆÙ…Ù†Ø·Ù‚ÙŠ', 'weight': 'T'},
                        {'text': 'Ù…Ù‡ØªÙ… ÙˆÙ…ØªØ¹Ø§Ø·Ù', 'weight': 'F'}
                    ]
                },
                {
                    'text': 'Ø¹Ù†Ø¯ Ø­Ù„ Ù†Ø²Ø§Ø¹ Ø¨ÙŠÙ† Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡:',
                    'options': [
                        {'text': 'ØªØ¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø­Ù„ Ø§Ù„Ø£ÙƒØ«Ø± Ø¹Ø¯Ø§Ù„Ø©', 'weight': 'T'},
                        {'text': 'ØªØ­Ø§ÙˆÙ„ ÙÙ‡Ù… Ù…Ø´Ø§Ø¹Ø± ÙƒÙ„ Ø·Ø±Ù', 'weight': 'F'}
                    ]
                }
            ]
        },
        'JP': {
            'name': 'Ø§Ù„Ø­Ø²Ù… Ù…Ù‚Ø§Ø¨Ù„ Ø§Ù„Ù…Ø±ÙˆÙ†Ø©',
            'description': 'ÙƒÙŠÙ ØªÙ†Ø¸Ù… Ø­ÙŠØ§ØªÙƒ ÙˆØªØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø®Ø·Ø·',
            'questions': [
                {
                    'text': 'ØªÙØ¶Ù„ Ø§Ù„Ø¹Ù…Ù„:',
                    'options': [
                        {'text': 'ÙˆÙÙ‚ Ø®Ø·Ø© Ù…Ø­Ø¯Ø¯Ø© ÙˆØ¬Ø¯ÙˆÙ„ Ø²Ù…Ù†ÙŠ', 'weight': 'J'},
                        {'text': 'Ø¨Ù…Ø±ÙˆÙ†Ø© Ø­Ø³Ø¨ Ø§Ù„Ø¸Ø±ÙˆÙ', 'weight': 'P'}
                    ]
                },
                {
                    'text': 'Ø¹Ù†Ø¯Ù…Ø§ ØªØ°Ù‡Ø¨ Ù„Ø±Ø­Ù„Ø©:',
                    'options': [
                        {'text': 'ØªØ®Ø·Ø· Ù„ÙƒÙ„ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ù…Ø³Ø¨Ù‚Ø§Ù‹', 'weight': 'J'},
                        {'text': 'ØªÙØ¶Ù„ Ø§Ù„Ø§Ø±ØªØ¬Ø§Ù„ ÙˆØ§ÙƒØªØ´Ø§Ù Ø§Ù„Ø£Ø´ÙŠØ§Ø¡', 'weight': 'P'}
                    ]
                },
                {
                    'text': 'ÙÙŠ Ù…Ø³Ø§Ø­Ø© Ø¹Ù…Ù„Ùƒ:',
                    'options': [
                        {'text': 'ÙƒÙ„ Ø´ÙŠØ¡ Ù…Ù†Ø¸Ù… ÙˆÙ…Ø±ØªØ¨', 'weight': 'J'},
                        {'text': 'ÙÙˆØ¶Ù‰ Ø¥Ø¨Ø¯Ø§Ø¹ÙŠØ© ÙˆÙ…Ø±ÙˆÙ†Ø©', 'weight': 'P'}
                    ]
                }
            ]
        }
    }
}

# Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø´Ø®ØµÙŠØ© MBTI
MBTI_TYPES = {
    'INTJ': {
        'name': 'Ø§Ù„Ù…Ø¹Ù…Ø§Ø± / Ø§Ù„Ø¹Ù‚Ù„ Ø§Ù„Ù…Ø¯Ø¨Ø±',
        'description': 'Ø´Ø®ØµÙŠØ© Ù…Ù†Ø·Ù‚ÙŠØ© ÙˆÙ…Ø³ØªÙ‚Ù„Ø© ÙˆØ­Ø§Ø²Ù…Ø©ØŒ ÙŠØªÙ…ØªØ¹ Ø¨Ø®ÙŠØ§Ù„ Ù‚ÙˆÙŠ ÙˆØ·Ù…ÙˆØ­ ÙƒØ¨ÙŠØ±.',
        'strengths': ['Ø§Ù„ØªÙÙƒÙŠØ± Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠ', 'Ø§Ù„Ø§Ø³ØªÙ‚Ù„Ø§Ù„ÙŠØ©', 'Ø§Ù„Ø­Ø²Ù…', 'Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹'],
        'weaknesses': ['ØµØ¹ÙˆØ¨Ø© ÙÙŠ Ø§Ù„ØªØ¹Ø¨ÙŠØ± Ø¹Ù† Ø§Ù„Ù…Ø´Ø§Ø¹Ø±', 'Ø§Ù„ÙƒÙ…Ø§Ù„ÙŠØ© Ø§Ù„Ù…ÙØ±Ø·Ø©', 'Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø²Ø§Ø¦Ø¯'],
        'careers': ['Ù…Ù‡Ù†Ø¯Ø³', 'Ø¹Ø§Ù„Ù…', 'Ù…Ø­Ø§Ù…', 'Ø·Ø¨ÙŠØ¨', 'Ù…Ø¨Ø±Ù…Ø¬', 'Ù…Ø³ØªØ´Ø§Ø± Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠ'],
        'advice': 'Ø±ÙƒØ² Ø¹Ù„Ù‰ ØªØ·ÙˆÙŠØ± Ù…Ù‡Ø§Ø±Ø§ØªÙƒ Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ© ÙˆØªØ¹Ù„Ù… ÙƒÙŠÙÙŠØ© Ø§Ù„ØªØ¹Ø¨ÙŠØ± Ø¹Ù† Ù…Ø´Ø§Ø¹Ø±Ùƒ.'
    },
    'INTP': {
        'name': 'Ø§Ù„Ù…ÙÙƒØ± / Ø§Ù„Ù…Ù†Ø·Ù‚ÙŠ',
        'description': 'Ø´Ø®ØµÙŠØ© ÙØ¶ÙˆÙ„ÙŠØ© ÙˆÙ…Ø±Ù†Ø©ØŒ ÙŠØ­Ø¨ Ø§Ø³ØªÙƒØ´Ø§Ù Ø§Ù„Ù†Ø¸Ø±ÙŠØ§Øª ÙˆØ§Ù„Ø£ÙÙƒØ§Ø± Ø§Ù„Ù…Ø¹Ù‚Ø¯Ø©.',
        'strengths': ['Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ù†Ø·Ù‚ÙŠ', 'Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹ Ø§Ù„Ù†Ø¸Ø±ÙŠ', 'Ø§Ù„Ù…Ø±ÙˆÙ†Ø© Ø§Ù„Ø°Ù‡Ù†ÙŠØ©', 'Ø§Ù„Ø§Ø³ØªÙ‚Ù„Ø§Ù„ÙŠØ©'],
        'weaknesses': ['ØªØ¬Ø§Ù‡Ù„ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©', 'ØµØ¹ÙˆØ¨Ø© ÙÙŠ Ø§ØªØ®Ø§Ø° Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª', 'ØªØ¬Ù†Ø¨ Ø§Ù„ØµØ±Ø§Ø¹Ø§Øª'],
        'careers': ['Ø¨Ø§Ø­Ø«', 'Ø¹Ø§Ù„Ù…', 'ÙÙŠÙ„Ø³ÙˆÙ', 'Ù…Ø¨Ø±Ù…Ø¬', 'ÙƒØ§ØªØ¨', 'Ù…Ø­Ù„Ù„'],
        'advice': 'Ø§Ø¹Ù…Ù„ Ø¹Ù„Ù‰ ØªØ·Ø¨ÙŠÙ‚ Ø£ÙÙƒØ§Ø±Ùƒ Ø§Ù„Ù†Ø¸Ø±ÙŠØ© ÙÙŠ Ù…Ø´Ø§Ø±ÙŠØ¹ Ø¹Ù…Ù„ÙŠØ© Ù…Ø­Ø¯Ø¯Ø©.'
    },
    'ENTJ': {
        'name': 'Ø§Ù„Ù‚Ø§Ø¦Ø¯ / Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠ',
        'description': 'Ø´Ø®ØµÙŠØ© Ù‚ÙŠØ§Ø¯ÙŠØ© Ø·Ø¨ÙŠØ¹ÙŠØ©ØŒ Ø­Ø§Ø²Ù…Ø© ÙˆÙˆØ§Ø«Ù‚Ø©ØŒ ØªØ­Ø¨ Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª ÙˆØ§Ù„Ù†ØªØ§Ø¦Ø¬.',
        'strengths': ['Ø§Ù„Ù‚ÙŠØ§Ø¯Ø© Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠØ©', 'Ø§Ù„ØªÙÙƒÙŠØ± Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠ', 'Ø§Ù„Ø«Ù‚Ø© Ø¨Ø§Ù„Ù†ÙØ³', 'Ø§Ù„ÙƒÙØ§Ø¡Ø©'],
        'weaknesses': ['Ø¹Ø¯Ù… Ø§Ù„ØµØ¨Ø±', 'Ø§Ù„ØªØ³Ù„Ø· Ø£Ø­ÙŠØ§Ù†Ø§Ù‹', 'ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ù…Ø´Ø§Ø¹Ø±'],
        'careers': ['Ù…Ø¯ÙŠØ± ØªÙ†ÙÙŠØ°ÙŠ', 'Ù…Ø­Ø§Ù…', 'Ù…Ø³ØªØ´Ø§Ø± Ø¥Ø¯Ø§Ø±ÙŠ', 'Ø±Ø§Ø¦Ø¯ Ø£Ø¹Ù…Ø§Ù„', 'Ø³ÙŠØ§Ø³ÙŠ'],
        'advice': 'ØªØ¹Ù„Ù… Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ø¢Ø±Ø§Ø¡ Ø§Ù„Ø¢Ø®Ø±ÙŠÙ† ÙˆØªÙ‚Ø¯ÙŠØ± Ù…Ø´Ø§Ø¹Ø±Ù‡Ù… ÙÙŠ Ø¹Ù…Ù„ÙŠØ© Ø§ØªØ®Ø§Ø° Ø§Ù„Ù‚Ø±Ø§Ø±.'
    },
    'ENTP': {
        'name': 'Ø§Ù„Ù…Ù†Ø§Ø¸Ø± / Ø§Ù„Ù…Ø¨ØªÙƒØ±',
        'description': 'Ø´Ø®ØµÙŠØ© Ù…Ø¨Ø¯Ø¹Ø© ÙˆÙ…ØªØ­Ù…Ø³Ø©ØŒ ØªØ­Ø¨ Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª Ø§Ù„Ø°Ù‡Ù†ÙŠØ© ÙˆØ§Ù„Ø£ÙÙƒØ§Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©.',
        'strengths': ['Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹', 'Ø§Ù„Ù…Ø±ÙˆÙ†Ø©', 'Ø§Ù„Ø­Ù…Ø§Ø³', 'Ø§Ù„ØªÙÙƒÙŠØ± Ø§Ù„Ø³Ø±ÙŠØ¹'],
        'weaknesses': ['Ø¹Ø¯Ù… Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø§Ù„ØªÙØ§ØµÙŠÙ„', 'ØªØ¬Ù†Ø¨ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø±ÙˆØªÙŠÙ†ÙŠØ©', 'ÙÙ‚Ø¯Ø§Ù† Ø§Ù„Ø§Ù‡ØªÙ…Ø§Ù… Ø¨Ø³Ø±Ø¹Ø©'],
        'careers': ['Ø±Ø§Ø¦Ø¯ Ø£Ø¹Ù…Ø§Ù„', 'Ù…Ø³ØªØ´Ø§Ø±', 'ØµØ­Ø§ÙÙŠ', 'Ù…Ø®ØªØ±Ø¹', 'Ù…Ø­Ø§Ù…ÙŠ', 'Ù…Ø·ÙˆØ±'],
        'advice': 'Ø§Ø¹Ù…Ù„ Ø¹Ù„Ù‰ Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„ØªÙŠ ØªØ¨Ø¯Ø£Ù‡Ø§ ÙˆØ·ÙˆØ± ØµØ¨Ø±Ùƒ Ù…Ø¹ Ø§Ù„ØªÙØ§ØµÙŠÙ„.'
    },
    'INFJ': {
        'name': 'Ø§Ù„Ù…Ø¯Ø§ÙØ¹ / Ø§Ù„Ù…Ø­Ø§Ù…ÙŠ',
        'description': 'Ø´Ø®ØµÙŠØ© Ù…Ø«Ø§Ù„ÙŠØ© ÙˆÙ…Ø¨Ø¯Ø¹Ø©ØŒ ØªØ³Ø¹Ù‰ Ù„Ø¥Ø­Ø¯Ø§Ø« ØªØ£Ø«ÙŠØ± Ø¥ÙŠØ¬Ø§Ø¨ÙŠ ÙÙŠ Ø§Ù„Ø¹Ø§Ù„Ù….',
        'strengths': ['Ø§Ù„ØªØ¹Ø§Ø·Ù Ø§Ù„Ø¹Ù…ÙŠÙ‚', 'Ø§Ù„Ø±Ø¤ÙŠØ© Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠØ©', 'Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹', 'Ø§Ù„Ù…Ø«Ø§Ù„ÙŠØ©'],
        'weaknesses': ['Ø§Ù„Ø­Ø³Ø§Ø³ÙŠØ© Ø§Ù„Ù…ÙØ±Ø·Ø©', 'Ø§Ù„ÙƒÙ…Ø§Ù„ÙŠØ©', 'ØªØ¬Ù†Ø¨ Ø§Ù„ØµØ±Ø§Ø¹Ø§Øª'],
        'careers': ['Ù…Ø³ØªØ´Ø§Ø± Ù†ÙØ³ÙŠ', 'ÙƒØ§ØªØ¨', 'Ù…Ø¹Ù„Ù…', 'Ø¹Ø§Ù…Ù„ Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ', 'ÙÙ†Ø§Ù†'],
        'advice': 'ØªØ¹Ù„Ù… ÙˆØ¶Ø¹ Ø­Ø¯ÙˆØ¯ ØµØ­ÙŠØ© ÙˆØªÙ‚Ø¨Ù„ Ø£Ù† Ø§Ù„ÙƒÙ…Ø§Ù„ ØºÙŠØ± Ù…Ù…ÙƒÙ†.'
    },
    'INFP': {
        'name': 'Ø§Ù„ÙˆØ³ÙŠØ· / Ø§Ù„Ù…Ø«Ø§Ù„ÙŠ',
        'description': 'Ø´Ø®ØµÙŠØ© Ù…Ø¨Ø¯Ø¹Ø© ÙˆÙ…ØªØ¹Ø§Ø·ÙØ©ØŒ ØªØ³Ø¹Ù‰ Ù„Ù„Ø£ØµØ§Ù„Ø© ÙˆØ§Ù„ØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ù‚ÙŠÙ…Ù‡Ø§.',
        'strengths': ['Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹', 'Ø§Ù„ØªØ¹Ø§Ø·Ù', 'Ø§Ù„Ù…Ø±ÙˆÙ†Ø©', 'Ø§Ù„Ø£ØµØ§Ù„Ø©'],
        'weaknesses': ['Ø£Ø®Ø° Ø§Ù„Ø£Ù…ÙˆØ± Ø¨ØµÙˆØ±Ø© Ø´Ø®ØµÙŠØ©', 'ØµØ¹ÙˆØ¨Ø© ÙÙŠ Ø§ØªØ®Ø§Ø° Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª', 'Ø§Ù„ØªØ³ÙˆÙŠÙ'],
        'careers': ['ÙÙ†Ø§Ù†', 'ÙƒØ§ØªØ¨', 'Ù…Ø³ØªØ´Ø§Ø±', 'Ù…Ø¹Ø§Ù„Ø¬ Ù†ÙØ³ÙŠ', 'Ù†Ø§Ø´Ø· Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ'],
        'advice': 'Ø§Ø¹Ù…Ù„ Ø¹Ù„Ù‰ ØªØ·ÙˆÙŠØ± Ù…Ù‡Ø§Ø±Ø§Øª Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆÙ‚Øª ÙˆØ§Ù„Ø«Ù‚Ø© Ø¨Ø§Ù„Ù†ÙØ³.'
    },
    'ENFJ': {
        'name': 'Ø§Ù„Ø¨Ø·Ù„ / Ø§Ù„Ù…Ø¹Ù„Ù…',
        'description': 'Ø´Ø®ØµÙŠØ© Ù…Ù„Ù‡Ù…Ø© ÙˆÙƒØ§Ø±ÙŠØ²Ù…ÙŠØ©ØŒ ØªØ­Ø¨ Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¢Ø®Ø±ÙŠÙ† Ø¹Ù„Ù‰ ØªØ­Ù‚ÙŠÙ‚ Ø¥Ù…ÙƒØ§Ù†Ø§ØªÙ‡Ù….',
        'strengths': ['Ø§Ù„Ù‚ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ù„Ù‡Ù…Ø©', 'Ø§Ù„ØªØ¹Ø§Ø·Ù', 'Ø§Ù„ØªÙˆØ§ØµÙ„', 'Ø§Ù„ØªØ­ÙÙŠØ²'],
        'weaknesses': ['Ø¥Ù‡Ù…Ø§Ù„ Ø§Ø­ØªÙŠØ§Ø¬Ø§ØªÙ‡Ù… Ø§Ù„Ø®Ø§ØµØ©', 'Ø§Ù„Ø­Ø³Ø§Ø³ÙŠØ© Ù„Ù„Ù†Ù‚Ø¯', 'Ø§Ù„Ù…Ø«Ø§Ù„ÙŠØ©'],
        'careers': ['Ù…Ø¹Ù„Ù…', 'Ù…Ø¯Ø±Ø¨', 'Ù…Ø³ØªØ´Ø§Ø±', 'Ù…Ø¯ÙŠØ± Ù…ÙˆØ§Ø±Ø¯ Ø¨Ø´Ø±ÙŠØ©', 'Ø®Ø·ÙŠØ¨'],
        'advice': 'ØªØ°ÙƒØ± Ø£Ù† ØªÙ‡ØªÙ… Ø¨Ù†ÙØ³Ùƒ ÙƒÙ…Ø§ ØªÙ‡ØªÙ… Ø¨Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†.'
    },
    'ENFP': {
        'name': 'Ø§Ù„Ù…ØªØ­Ù…Ø³ / Ø§Ù„Ù…Ø´Ø¬Ø¹',
        'description': 'Ø´Ø®ØµÙŠØ© Ù…ØªØ­Ù…Ø³Ø© ÙˆÙ…Ø¨Ø¯Ø¹Ø© ÙˆØ§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©ØŒ ØªØ­Ø¨ Ø§Ø³ØªÙƒØ´Ø§Ù Ø§Ù„Ø¥Ù…ÙƒØ§Ù†ÙŠØ§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©.',
        'strengths': ['Ø§Ù„Ø­Ù…Ø§Ø³', 'Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹', 'Ø§Ù„Ù…Ø±ÙˆÙ†Ø©', 'Ø§Ù„ØªÙØ§Ø¤Ù„'],
        'weaknesses': ['Ø¹Ø¯Ù… Ø§Ù„ØªØ±ÙƒÙŠØ²', 'Ø§Ù„ØªØ³ÙˆÙŠÙ', 'Ø§Ù„Ø­Ø³Ø§Ø³ÙŠØ© Ù„Ù„Ø¶ØºØ·'],
        'careers': ['Ø¥Ø¹Ù„Ø§Ù…ÙŠ', 'Ù…Ø³ØªØ´Ø§Ø±', 'Ù…Ø·ÙˆØ± Ù…Ù†ØªØ¬Ø§Øª', 'Ù…Ø¹Ù„Ù…', 'Ù…Ø³ÙˆÙ‚'],
        'advice': 'Ø§Ø¹Ù…Ù„ Ø¹Ù„Ù‰ ØªØ·ÙˆÙŠØ± Ø§Ù„Ø§Ù†Ø¶Ø¨Ø§Ø· Ø§Ù„Ø°Ø§ØªÙŠ ÙˆØ§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø£Ù‡Ø¯Ø§ÙÙƒ.'
    },
    'ISTJ': {
        'name': 'Ø§Ù„Ù„ÙˆØ¬Ø³ØªÙŠ / Ø§Ù„Ù…Ø¯Ø¨Ø±',
        'description': 'Ø´Ø®ØµÙŠØ© Ù…ÙˆØ«ÙˆÙ‚Ø© ÙˆÙ…Ø³Ø¤ÙˆÙ„Ø©ØŒ ØªØ­ØªØ±Ù… Ø§Ù„ØªÙ‚Ø§Ù„ÙŠØ¯ ÙˆØ§Ù„Ù†Ø¸Ø§Ù….',
        'strengths': ['Ø§Ù„Ù…ÙˆØ«ÙˆÙ‚ÙŠØ©', 'Ø§Ù„ØªÙ†Ø¸ÙŠÙ…', 'Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠØ©', 'Ø§Ù„ØµØ¨Ø±'],
        'weaknesses': ['Ù…Ù‚Ø§ÙˆÙ…Ø© Ø§Ù„ØªØºÙŠÙŠØ±', 'ØµØ¹ÙˆØ¨Ø© ÙÙŠ Ø§Ù„ØªØ¹Ø¨ÙŠØ± Ø¹Ù† Ø§Ù„Ù…Ø´Ø§Ø¹Ø±', 'Ø§Ù„Ø¬Ù…ÙˆØ¯ Ø£Ø­ÙŠØ§Ù†Ø§Ù‹'],
        'careers': ['Ù…Ø­Ø§Ø³Ø¨', 'Ù…Ù‡Ù†Ø¯Ø³', 'Ù…Ø¯ÙŠØ± Ù…Ø§Ù„ÙŠ', 'Ù…Ø­Ø§Ù…ÙŠ', 'Ø·Ø¨ÙŠØ¨'],
        'advice': 'ÙƒÙ† Ø£ÙƒØ«Ø± Ø§Ù†ÙØªØ§Ø­Ø§Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø£ÙÙƒØ§Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙˆØ§Ù„ØªØºÙŠÙŠØ±.'
    },
    'ISFJ': {
        'name': 'Ø§Ù„Ù…Ø¯Ø§ÙØ¹ / Ø§Ù„Ø­Ø§Ù…ÙŠ',
        'description': 'Ø´Ø®ØµÙŠØ© Ù…Ø­Ø¨Ø© ÙˆÙ…Ù‡ØªÙ…Ø© Ø¨Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†ØŒ ØªØ³Ø¹Ù‰ Ù„Ø­Ù…Ø§ÙŠØ© ÙˆØ¯Ø¹Ù… Ù…Ù† Ø­ÙˆÙ„Ù‡Ø§.',
        'strengths': ['Ø§Ù„ØªØ¹Ø§Ø·Ù', 'Ø§Ù„Ù…ÙˆØ«ÙˆÙ‚ÙŠØ©', 'Ø§Ù„ØµØ¨Ø±', 'Ø§Ù„Ø§Ù‡ØªÙ…Ø§Ù… Ø¨Ø§Ù„ØªÙØ§ØµÙŠÙ„'],
        'weaknesses': ['ØµØ¹ÙˆØ¨Ø© ÙÙŠ Ù‚ÙˆÙ„ Ù„Ø§', 'ØªØ¬Ù†Ø¨ Ø§Ù„ØµØ±Ø§Ø¹Ø§Øª', 'Ø¥Ù‡Ù…Ø§Ù„ Ø§Ø­ØªÙŠØ§Ø¬Ø§ØªÙ‡Ù…'],
        'careers': ['Ù…Ù…Ø±Ø¶', 'Ù…Ø¹Ù„Ù…', 'Ø¹Ø§Ù…Ù„ Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ', 'Ù…Ø³ØªØ´Ø§Ø±', 'Ø·Ø¨ÙŠØ¨ Ø£Ø·ÙØ§Ù„'],
        'advice': 'ØªØ¹Ù„Ù… ÙˆØ¶Ø¹ Ø­Ø¯ÙˆØ¯ ØµØ­ÙŠØ© ÙˆØ§Ù„Ø§Ù‡ØªÙ…Ø§Ù… Ø¨Ù†ÙØ³Ùƒ Ø£ÙŠØ¶Ø§Ù‹.'
    },
    'ESTJ': {
        'name': 'Ø§Ù„Ù…Ù†ÙØ° / Ø§Ù„Ù…Ø¯ÙŠØ±',
        'description': 'Ø´Ø®ØµÙŠØ© Ù…Ù†Ø¸Ù…Ø© ÙˆØ¹Ù…Ù„ÙŠØ©ØŒ ØªØ­Ø¨ Ø§Ù„Ù†Ø¸Ø§Ù… ÙˆØ§Ù„ÙƒÙØ§Ø¡Ø© ÙÙŠ Ø§Ù„Ø¹Ù…Ù„.',
        'strengths': ['Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©', 'Ø§Ù„ØªÙ†Ø¸ÙŠÙ…', 'Ø§Ù„ÙƒÙØ§Ø¡Ø©', 'Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠØ©'],
        'weaknesses': ['Ø¹Ø¯Ù… Ø§Ù„Ù…Ø±ÙˆÙ†Ø©', 'ØµØ¹ÙˆØ¨Ø© ÙÙŠ Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ù…Ø´Ø§Ø¹Ø±', 'Ø§Ù„ØªØ³Ù„Ø· Ø£Ø­ÙŠØ§Ù†Ø§Ù‹'],
        'careers': ['Ù…Ø¯ÙŠØ±', 'Ù…Ø­Ø§Ù…ÙŠ', 'Ø¶Ø§Ø¨Ø·', 'Ù…Ø¯ÙŠØ± Ù…Ø§Ù„ÙŠ', 'Ø±Ø¬Ù„ Ø£Ø¹Ù…Ø§Ù„'],
        'advice': 'Ø§Ø¹Ù…Ù„ Ø¹Ù„Ù‰ ØªØ·ÙˆÙŠØ± Ù…Ø±ÙˆÙ†ØªÙƒ ÙˆØ§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„ÙˆØ¬Ù‡Ø§Øª Ø§Ù„Ù†Ø¸Ø± Ø§Ù„Ø£Ø®Ø±Ù‰.'
    },
    'ESFJ': {
        'name': 'Ø§Ù„Ù‚Ù†ØµÙ„ / Ø§Ù„Ù…Ø¶ÙŠÙ',
        'description': 'Ø´Ø®ØµÙŠØ© Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ© ÙˆÙ…Ù‡ØªÙ…Ø©ØŒ ØªØ­Ø¨ Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¢Ø®Ø±ÙŠÙ† ÙˆØ®Ù„Ù‚ Ø§Ù„Ø§Ù†Ø³Ø¬Ø§Ù….',
        'strengths': ['Ø§Ù„ØªØ¹Ø§Ø·Ù', 'Ø§Ù„ØªØ¹Ø§ÙˆÙ†', 'Ø§Ù„Ù…ÙˆØ«ÙˆÙ‚ÙŠØ©', 'Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©'],
        'weaknesses': ['Ø§Ù„Ø­Ø³Ø§Ø³ÙŠØ© Ù„Ù„Ù†Ù‚Ø¯', 'ØµØ¹ÙˆØ¨Ø© ÙÙŠ Ù‚ÙˆÙ„ Ù„Ø§', 'ØªØ¬Ù†Ø¨ Ø§Ù„ØµØ±Ø§Ø¹Ø§Øª'],
        'careers': ['Ù…Ø¹Ù„Ù…', 'Ù…Ù…Ø±Ø¶', 'Ù…Ø³ØªØ´Ø§Ø±', 'Ù…Ø¯ÙŠØ± Ù…ÙˆØ§Ø±Ø¯ Ø¨Ø´Ø±ÙŠØ©', 'Ù…Ù†Ø³Ù‚ ÙØ¹Ø§Ù„ÙŠØ§Øª'],
        'advice': 'ØªØ¹Ù„Ù… Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ù†Ù‚Ø¯ Ø§Ù„Ø¨Ù†Ø§Ø¡ ÙˆØªØ·ÙˆÙŠØ± Ø«Ù‚ØªÙƒ Ø¨Ù†ÙØ³Ùƒ.'
    },
    'ISTP': {
        'name': 'Ø§Ù„ÙÙ†ÙŠ / Ø§Ù„Ø­Ø±ÙÙŠ',
        'description': 'Ø´Ø®ØµÙŠØ© Ø¹Ù…Ù„ÙŠØ© ÙˆÙ…Ø±Ù†Ø©ØŒ ØªØ­Ø¨ Ø§Ø³ØªÙƒØ´Ø§Ù Ø§Ù„Ø£Ø´ÙŠØ§Ø¡ Ø¨Ø§Ù„ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ø¹Ù…Ù„ÙŠØ©.',
        'strengths': ['Ø­Ù„ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©', 'Ø§Ù„Ù…Ø±ÙˆÙ†Ø©', 'Ø§Ù„Ù‡Ø¯ÙˆØ¡ ØªØ­Øª Ø§Ù„Ø¶ØºØ·', 'Ø§Ù„Ø§Ø³ØªÙ‚Ù„Ø§Ù„ÙŠØ©'],
        'weaknesses': ['ØµØ¹ÙˆØ¨Ø© ÙÙŠ Ø§Ù„ØªØ¹Ø¨ÙŠØ± Ø¹Ù† Ø§Ù„Ù…Ø´Ø§Ø¹Ø±', 'ØªØ¬Ù†Ø¨ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª', 'Ø§Ù„Ø¹Ø²Ù„Ø© Ø£Ø­ÙŠØ§Ù†Ø§Ù‹'],
        'careers': ['Ù…Ù‡Ù†Ø¯Ø³', 'ÙÙ†ÙŠ', 'Ø·ÙŠØ§Ø±', 'Ø±ÙŠØ§Ø¶ÙŠ', 'Ù…Ø·ÙˆØ± Ø¨Ø±Ù…Ø¬ÙŠØ§Øª'],
        'advice': 'Ø§Ø¹Ù…Ù„ Ø¹Ù„Ù‰ ØªØ·ÙˆÙŠØ± Ù…Ù‡Ø§Ø±Ø§ØªÙƒ ÙÙŠ Ø§Ù„ØªÙˆØ§ØµÙ„ ÙˆØ§Ù„ØªØ¹Ø¨ÙŠØ± Ø¹Ù† Ù…Ø´Ø§Ø¹Ø±Ùƒ.'
    },
    'ISFP': {
        'name': 'Ø§Ù„Ù…ØºØ§Ù…Ø± / Ø§Ù„ÙÙ†Ø§Ù†',
        'description': 'Ø´Ø®ØµÙŠØ© Ù…Ø¨Ø¯Ø¹Ø© ÙˆÙ…Ø±Ù†Ø©ØŒ ØªÙ‚Ø¯Ø± Ø§Ù„Ø¬Ù…Ø§Ù„ ÙˆØ§Ù„Ø£ØµØ§Ù„Ø© ÙÙŠ Ø§Ù„Ø­ÙŠØ§Ø©.',
        'strengths': ['Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹', 'Ø§Ù„ØªØ¹Ø§Ø·Ù', 'Ø§Ù„Ù…Ø±ÙˆÙ†Ø©', 'Ø§Ù„ØªÙ‚Ø¯ÙŠØ± Ø§Ù„Ø¬Ù…Ø§Ù„ÙŠ'],
        'weaknesses': ['ØµØ¹ÙˆØ¨Ø© ÙÙŠ Ø§Ù„ØªØ®Ø·ÙŠØ· Ø·ÙˆÙŠÙ„ Ø§Ù„Ù…Ø¯Ù‰', 'Ø§Ù„Ø­Ø³Ø§Ø³ÙŠØ© Ù„Ù„Ù†Ù‚Ø¯', 'ØªØ¬Ù†Ø¨ Ø§Ù„ØµØ±Ø§Ø¹Ø§Øª'],
        'careers': ['ÙÙ†Ø§Ù†', 'Ù…ØµÙ…Ù…', 'Ù…ÙˆØ³ÙŠÙ‚ÙŠ', 'Ù…ØµÙˆØ±', 'Ù…Ø¹Ø§Ù„Ø¬ Ø·Ø¨ÙŠØ¹ÙŠ'],
        'advice': 'Ø§Ø¹Ù…Ù„ Ø¹Ù„Ù‰ ØªØ·ÙˆÙŠØ± Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„ØªØ®Ø·ÙŠØ· ÙˆØ§Ù„Ø«Ù‚Ø© Ø¨Ø§Ù„Ù†ÙØ³.'
    },
    'ESTP': {
        'name': 'Ø±Ø¬Ù„ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ / Ø§Ù„Ù…Ø¤Ø¯ÙŠ',
        'description': 'Ø´Ø®ØµÙŠØ© Ù†Ø´ÙŠØ·Ø© ÙˆÙ…Ø±Ø­Ø©ØŒ ØªØ­Ø¨ Ø§Ù„Ø¹Ù…Ù„ ÙˆØ§Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø§Ù„Ù†Ø§Ø³.',
        'strengths': ['Ø§Ù„Ù…Ø±ÙˆÙ†Ø©', 'Ø§Ù„ÙƒØ§Ø±ÙŠØ²Ù…Ø§', 'Ø§Ù„Ø¹Ù…Ù„ÙŠØ©', 'Ø­Ù„ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ø³Ø±ÙŠØ¹'],
        'weaknesses': ['Ø¹Ø¯Ù… Ø§Ù„ØµØ¨Ø±', 'ØµØ¹ÙˆØ¨Ø© ÙÙŠ Ø§Ù„ØªØ®Ø·ÙŠØ· Ø·ÙˆÙŠÙ„ Ø§Ù„Ù…Ø¯Ù‰', 'ØªØ¬Ù†Ø¨ Ø§Ù„Ù†Ø¸Ø±ÙŠØ§Øª'],
        'careers': ['Ù…Ù†Ø¯ÙˆØ¨ Ù…Ø¨ÙŠØ¹Ø§Øª', 'Ù…Ù…Ø«Ù„', 'Ø±ÙŠØ§Ø¶ÙŠ', 'Ø±Ø§Ø¦Ø¯ Ø£Ø¹Ù…Ø§Ù„', 'Ù…Ø¯ÙŠØ± Ù…Ø´Ø±ÙˆØ¹'],
        'advice': 'Ø§Ø¹Ù…Ù„ Ø¹Ù„Ù‰ ØªØ·ÙˆÙŠØ± ØµØ¨Ø±Ùƒ ÙˆÙ…Ù‡Ø§Ø±Ø§Øª Ø§Ù„ØªØ®Ø·ÙŠØ· Ø·ÙˆÙŠÙ„ Ø§Ù„Ù…Ø¯Ù‰.'
    },
    'ESFP': {
        'name': 'Ø§Ù„Ù…Ø¤Ø¯ÙŠ / Ø§Ù„Ù…Ø³Ù„ÙŠ',
        'description': 'Ø´Ø®ØµÙŠØ© Ù…ØªØ­Ù…Ø³Ø© ÙˆÙ…Ø±Ø­Ø©ØŒ ØªØ­Ø¨ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨Ù‡Ø¬Ø© Ø¹Ù„Ù‰ Ø­ÙŠØ§Ø© Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†.',
        'strengths': ['Ø§Ù„Ø­Ù…Ø§Ø³', 'Ø§Ù„ØªÙØ§Ø¤Ù„', 'Ø§Ù„Ù…Ø±ÙˆÙ†Ø©', 'Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©'],
        'weaknesses': ['ØµØ¹ÙˆØ¨Ø© ÙÙŠ Ø§Ù„ØªØ®Ø·ÙŠØ·', 'ØªØ¬Ù†Ø¨ Ø§Ù„ØµØ±Ø§Ø¹Ø§Øª', 'Ø¹Ø¯Ù… Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„'],
        'careers': ['Ù…Ù…Ø«Ù„', 'Ù…Ø¹Ù„Ù…', 'Ù…Ø³ØªØ´Ø§Ø±', 'Ù…Ù†Ø³Ù‚ ÙØ¹Ø§Ù„ÙŠØ§Øª', 'Ù…Ø¯Ø±Ø¨'],
        'advice': 'Ø§Ø¹Ù…Ù„ Ø¹Ù„Ù‰ ØªØ·ÙˆÙŠØ± Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„ØªØ®Ø·ÙŠØ· ÙˆØ§Ù„ØªÙÙƒÙŠØ± ÙÙŠ Ø§Ù„Ø¹ÙˆØ§Ù‚Ø¨ Ø·ÙˆÙŠÙ„Ø© Ø§Ù„Ù…Ø¯Ù‰.'
    }
}

# Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø§Ù„Ù†ÙØ³ÙŠØ© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©
PSYCHOLOGICAL_ASSESSMENTS = {
    'phq9': {
        'name': 'Ø§Ø³ØªØ¨ÙŠØ§Ù† Ø§Ù„Ø§ÙƒØªØ¦Ø§Ø¨ PHQ-9',
        'icon': 'ğŸ˜”',
        'questions': [
            "Ù‚Ù„Ø© Ø§Ù„Ø§Ù‡ØªÙ…Ø§Ù… Ø£Ùˆ Ø§Ù„Ù…ØªØ¹Ø© ÙÙŠ ÙØ¹Ù„ Ø§Ù„Ø£Ø´ÙŠØ§Ø¡",
            "Ø§Ù„Ø´Ø¹ÙˆØ± Ø¨Ø§Ù„Ø¥Ø­Ø¨Ø§Ø· Ø£Ùˆ Ø§Ù„Ø§ÙƒØªØ¦Ø§Ø¨ Ø£Ùˆ Ø§Ù„ÙŠØ£Ø³",
            "ØµØ¹ÙˆØ¨Ø© ÙÙŠ Ø§Ù„Ù†ÙˆÙ… Ø£Ùˆ Ø§Ù„Ù†ÙˆÙ… Ø£ÙƒØ«Ø± Ù…Ù† Ø§Ù„Ù„Ø§Ø²Ù…",
            "Ø§Ù„Ø´Ø¹ÙˆØ± Ø¨Ø§Ù„ØªØ¹Ø¨ Ø£Ùˆ Ù‚Ù„Ø© Ø§Ù„Ø·Ø§Ù‚Ø©",
            "Ø¶Ø¹Ù Ø§Ù„Ø´Ù‡ÙŠØ© Ø£Ùˆ Ø§Ù„Ø¥ÙØ±Ø§Ø· ÙÙŠ Ø§Ù„Ø£ÙƒÙ„",
            "Ø§Ù„Ø´Ø¹ÙˆØ± Ø§Ù„Ø³ÙŠØ¡ ØªØ¬Ø§Ù‡ Ù†ÙØ³Ùƒ",
            "ØµØ¹ÙˆØ¨Ø© ÙÙŠ Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø´ÙŠØ§Ø¡",
            "Ø§Ù„ØªØ­Ø±Ùƒ Ø£Ùˆ Ø§Ù„ØªØ­Ø¯Ø« Ø¨Ø¨Ø·Ø¡ Ø´Ø¯ÙŠØ¯ Ø£Ùˆ Ø§Ù„Ø¹ÙƒØ³",
            "Ø£ÙÙƒØ§Ø± Ø¥ÙŠØ°Ø§Ø¡ Ø§Ù„Ù†ÙØ³ Ø£Ùˆ Ø§Ù„Ù…ÙˆØª"
        ],
        'options': [("Ù…Ø·Ù„Ù‚Ø§Ù‹", 0), ("Ø¹Ø¯Ø© Ø£ÙŠØ§Ù…", 1), ("Ø£ÙƒØ«Ø± Ù…Ù† Ù†ØµÙ Ø§Ù„Ø£ÙŠØ§Ù…", 2), ("ØªÙ‚Ø±ÙŠØ¨Ø§Ù‹ ÙƒÙ„ ÙŠÙˆÙ…", 3)]
    },
    'gad7': {
        'name': 'Ù…Ù‚ÙŠØ§Ø³ Ø§Ù„Ù‚Ù„Ù‚ Ø§Ù„Ø¹Ø§Ù… GAD-7',
        'icon': 'ğŸ˜°',
        'questions': [
            "Ø§Ù„Ø´Ø¹ÙˆØ± Ø¨Ø§Ù„Ø¹ØµØ¨ÙŠØ© Ø£Ùˆ Ø§Ù„Ù‚Ù„Ù‚ Ø£Ùˆ Ø§Ù„ØªÙˆØªØ±",
            "Ø¹Ø¯Ù… Ø§Ù„Ù‚Ø¯Ø±Ø© Ø¹Ù„Ù‰ Ø§Ù„ØªÙˆÙ‚Ù Ø¹Ù† Ø§Ù„Ù‚Ù„Ù‚ Ø£Ùˆ Ø§Ù„Ø³ÙŠØ·Ø±Ø© Ø¹Ù„ÙŠÙ‡",
            "Ø§Ù„Ù‚Ù„Ù‚ Ø§Ù„Ø´Ø¯ÙŠØ¯ Ø­ÙˆÙ„ Ø£Ø´ÙŠØ§Ø¡ Ù…Ø®ØªÙ„ÙØ©",
            "ØµØ¹ÙˆØ¨Ø© ÙÙŠ Ø§Ù„Ø§Ø³ØªØ±Ø®Ø§Ø¡",
            "Ø§Ù„Ø´Ø¹ÙˆØ± Ø¨Ø§Ù„Ù‚Ù„Ù‚ Ø§Ù„Ø´Ø¯ÙŠØ¯ Ù„Ø¯Ø±Ø¬Ø© ØµØ¹ÙˆØ¨Ø© Ø§Ù„Ø¨Ù‚Ø§Ø¡ Ø³Ø§ÙƒÙ†Ø§Ù‹",
            "Ø§Ù„Ø§Ù†Ø²Ø¹Ø§Ø¬ Ø£Ùˆ Ø§Ù„ØºØ¶Ø¨ Ø¨Ø³Ù‡ÙˆÙ„Ø©",
            "Ø§Ù„Ø´Ø¹ÙˆØ± Ø¨Ø§Ù„Ø®ÙˆÙ ÙƒÙ…Ø§ Ù„Ùˆ Ø£Ù† Ø´ÙŠØ¦Ø§Ù‹ ÙØ¸ÙŠØ¹Ø§Ù‹ Ù‚Ø¯ ÙŠØ­Ø¯Ø«"
        ],
        'options': [("Ù…Ø·Ù„Ù‚Ø§Ù‹", 0), ("Ø¹Ø¯Ø© Ø£ÙŠØ§Ù…", 1), ("Ø£ÙƒØ«Ø± Ù…Ù† Ù†ØµÙ Ø§Ù„Ø£ÙŠØ§Ù…", 2), ("ØªÙ‚Ø±ÙŠØ¨Ø§Ù‹ ÙƒÙ„ ÙŠÙˆÙ…", 3)]
    },
    'mbti': {
        'name': 'ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø´Ø®ØµÙŠØ© Ù…Ø§ÙŠØ±Ø²-Ø¨Ø±ÙŠØºØ² (MBTI)',
        'icon': 'ğŸ§ ',
        'description': 'Ø§Ø®ØªØ¨Ø§Ø± Ø´Ø§Ù…Ù„ Ù„ØªØ­Ø¯ÙŠØ¯ Ù†Ù…Ø· Ø´Ø®ØµÙŠØªÙƒ ÙˆÙÙ‚Ø§Ù‹ Ù„Ù…Ø¤Ø´Ø± Ù…Ø§ÙŠØ±Ø²-Ø¨Ø±ÙŠØºØ² Ø§Ù„Ù…Ø¹ØªÙ…Ø¯ Ø¹Ø§Ù„Ù…ÙŠØ§Ù‹'
    },
    'psychological_evaluation': {
        'name': 'Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†ÙØ³ÙŠ Ø§Ù„Ø´Ø§Ù…Ù„',
        'icon': 'ğŸ”',
        'description': 'ØªÙ‚ÙŠÙŠÙ… Ù†ÙØ³ÙŠ Ù…ØªÙƒØ§Ù…Ù„ ÙŠØ´Ù…Ù„ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ø¨ÙŠ ÙˆØ§Ù„Ø¨ÙŠØ¦Ø© Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ© ÙˆØ§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù†ÙØ³ÙŠØ©',
        'categories': [
            'medical_history',
            'social_environment', 
            'addiction_behaviors',
            'psychological_state'
        ]
    }
}

# Ø£Ø³Ø¦Ù„Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†ÙØ³ÙŠ Ø§Ù„Ø´Ø§Ù…Ù„
PSYCHOLOGICAL_QUESTIONS = {
    'medical_history': [
        {
            'id': 'mh_001',
            'question': 'Ù‡Ù„ ØªØ¹Ø§Ù†ÙŠ Ù…Ù† Ø£ÙŠ Ø£Ù…Ø±Ø§Ø¶ Ù…Ø²Ù…Ù†Ø©ØŸ',
            'type': 'multiple_choice',
            'options': ['Ù†Ø¹Ù…', 'Ù„Ø§', 'ØºÙŠØ± Ù…ØªØ£ÙƒØ¯'],
            'required': True
        },
        {
            'id': 'mh_002', 
            'question': 'Ù‡Ù„ ØªØªÙ†Ø§ÙˆÙ„ Ø£ÙŠ Ø£Ø¯ÙˆÙŠØ© Ø¨Ø§Ù†ØªØ¸Ø§Ù…ØŸ',
            'type': 'multiple_choice',
            'options': ['Ù†Ø¹Ù…', 'Ù„Ø§'],
            'required': True
        },
        {
            'id': 'mh_003',
            'question': 'Ù‡Ù„ Ø³Ø¨Ù‚ Ø£Ù† ØªÙ„Ù‚ÙŠØª Ø¹Ù„Ø§Ø¬Ø§Ù‹ Ù†ÙØ³ÙŠØ§Ù‹ØŸ',
            'type': 'multiple_choice', 
            'options': ['Ù†Ø¹Ù…', 'Ù„Ø§', 'Ø£ÙØ¶Ù„ Ø¹Ø¯Ù… Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©'],
            'required': False
        }
    ],
    'social_environment': [
        {
            'id': 'se_001',
            'question': 'ÙƒÙŠÙ ØªÙ‚ÙŠÙ… Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø¯Ø¹Ù… Ù…Ù† Ø¹Ø§Ø¦Ù„ØªÙƒØŸ',
            'type': 'scale',
            'scale_min': 1,
            'scale_max': 5,
            'scale_labels': ['Ø¶Ø¹ÙŠÙ Ø¬Ø¯Ø§Ù‹', 'Ø¶Ø¹ÙŠÙ', 'Ù…ØªÙˆØ³Ø·', 'Ø¬ÙŠØ¯', 'Ù…Ù…ØªØ§Ø²'],
            'required': True
        },
        {
            'id': 'se_002',
            'question': 'ÙƒÙŠÙ ØªÙ‚ÙŠÙ… Ø¹Ù„Ø§Ù‚Ø§ØªÙƒ Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©ØŸ',
            'type': 'scale',
            'scale_min': 1,
            'scale_max': 5,
            'scale_labels': ['Ø¶Ø¹ÙŠÙØ© Ø¬Ø¯Ø§Ù‹', 'Ø¶Ø¹ÙŠÙØ©', 'Ù…ØªÙˆØ³Ø·Ø©', 'Ø¬ÙŠØ¯Ø©', 'Ù…Ù…ØªØ§Ø²Ø©'],
            'required': True
        }
    ],
    'addiction_behaviors': [
        {
            'id': 'ab_001',
            'question': 'Ù‡Ù„ ØªØ´Ø¹Ø± Ø£Ù† Ù„Ø¯ÙŠÙƒ Ø³Ù„ÙˆÙƒÙŠØ§Øª Ù‚Ø¯ ØªÙƒÙˆÙ† Ø¶Ø§Ø±Ø© Ø£Ùˆ Ø¥Ø¯Ù…Ø§Ù†ÙŠØ©ØŸ',
            'type': 'multiple_choice',
            'options': ['Ù†Ø¹Ù…', 'Ù„Ø§', 'ØºÙŠØ± Ù…ØªØ£ÙƒØ¯', 'Ø£ÙØ¶Ù„ Ø¹Ø¯Ù… Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©'],
            'required': False
        }
    ],
    'psychological_state': [
        {
            'id': 'ps_001',
            'question': 'ÙƒÙŠÙ ØªÙ‚ÙŠÙ… Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªÙˆØªØ± ÙÙŠ Ø­ÙŠØ§ØªÙƒ Ø­Ø§Ù„ÙŠØ§Ù‹ØŸ',
            'type': 'scale',
            'scale_min': 1,
            'scale_max': 5,
            'scale_labels': ['Ù…Ù†Ø®ÙØ¶ Ø¬Ø¯Ø§Ù‹', 'Ù…Ù†Ø®ÙØ¶', 'Ù…ØªÙˆØ³Ø·', 'Ø¹Ø§Ù„ÙŠ', 'Ø¹Ø§Ù„ÙŠ Ø¬Ø¯Ø§Ù‹'],
            'required': True
        }
    ]
}

# Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„Ø¯ÙŠÙ†ÙŠ ÙˆØ§Ù„ÙÙ„Ø³ÙÙŠ
SUPPORT_RESOURCES = {
    'religious': [
        {
            'category': 'stress_relief',
            'title': 'Ø§Ù„ØµØ¨Ø± ÙÙŠ Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…',
            'content': 'Ù‚Ø§Ù„ Ø§Ù„Ù„Ù‡ ØªØ¹Ø§Ù„Ù‰: "ÙˆÙØ§ØµÙ’Ø¨ÙØ±Ù’ ÙˆÙÙ…ÙØ§ ØµÙØ¨Ù’Ø±ÙÙƒÙ Ø¥ÙÙ„ÙÙ‘Ø§ Ø¨ÙØ§Ù„Ù„ÙÙ‘Ù‡Ù ÙˆÙÙ„ÙØ§ ØªÙØ­Ù’Ø²ÙÙ†Ù’ Ø¹ÙÙ„ÙÙŠÙ’Ù‡ÙÙ…Ù’ ÙˆÙÙ„ÙØ§ ØªÙÙƒÙ ÙÙÙŠ Ø¶ÙÙŠÙ’Ù‚Ù Ù…ÙÙ‘Ù…ÙÙ‘Ø§ ÙŠÙÙ…Ù’ÙƒÙØ±ÙÙˆÙ†Ù" (Ø§Ù„Ù†Ø­Ù„: 127). Ø§Ù„ØµØ¨Ø± Ù‡Ùˆ Ù…ÙØªØ§Ø­ Ø§Ù„ÙØ±Ø¬ØŒ ÙˆÙ‡Ùˆ Ù…Ù† Ø£Ø¹Ø¸Ù… Ø§Ù„ØµÙØ§Øª Ø§Ù„ØªÙŠ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠØªØ­Ù„Ù‰ Ø¨Ù‡Ø§ Ø§Ù„Ù…Ø¤Ù…Ù† ÙÙŠ Ù…ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØµØ¹Ø§Ø¨.',
            'source': 'Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ… - Ø³ÙˆØ±Ø© Ø§Ù„Ù†Ø­Ù„',
            'tags': ['stress', 'patience', 'quran', 'relief']
        },
        {
            'category': 'anxiety_relief',
            'title': 'Ø§Ù„Ø°ÙƒØ± ÙˆØ·Ù…Ø£Ù†ÙŠÙ†Ø© Ø§Ù„Ù‚Ù„Ø¨',
            'content': 'Ù‚Ø§Ù„ Ø§Ù„Ù„Ù‡ ØªØ¹Ø§Ù„Ù‰: "Ø§Ù„ÙÙ‘Ø°ÙÙŠÙ†Ù Ø¢Ù…ÙÙ†ÙÙˆØ§ ÙˆÙØªÙØ·Ù’Ù…ÙØ¦ÙÙ†ÙÙ‘ Ù‚ÙÙ„ÙÙˆØ¨ÙÙ‡ÙÙ… Ø¨ÙØ°ÙÙƒÙ’Ø±Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø£ÙÙ„ÙØ§ Ø¨ÙØ°ÙÙƒÙ’Ø±Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù ØªÙØ·Ù’Ù…ÙØ¦ÙÙ†ÙÙ‘ Ø§Ù„Ù’Ù‚ÙÙ„ÙÙˆØ¨Ù" (Ø§Ù„Ø±Ø¹Ø¯: 28). Ø°ÙƒØ± Ø§Ù„Ù„Ù‡ ØªØ¹Ø§Ù„Ù‰ ÙŠØ¬Ù„Ø¨ Ø§Ù„Ø³ÙƒÙŠÙ†Ø© ÙˆØ§Ù„Ø·Ù…Ø£Ù†ÙŠÙ†Ø© Ù„Ù„Ù‚Ù„Ø¨ Ø§Ù„Ù…Ø¶Ø·Ø±Ø¨.',
            'source': 'Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ… - Ø³ÙˆØ±Ø© Ø§Ù„Ø±Ø¹Ø¯',
            'tags': ['anxiety', 'dhikr', 'peace', 'heart']
        }
    ],
    'philosophical': [
        {
            'category': 'stoicism',
            'title': 'Ø­ÙƒÙ…Ø© Ø¥Ø¨ÙƒØªÙŠØªÙˆØ³ ÙÙŠ Ø§Ù„ØªØ­ÙƒÙ…',
            'content': 'Ù‚Ø§Ù„ Ø§Ù„ÙÙŠÙ„Ø³ÙˆÙ Ø¥Ø¨ÙƒØªÙŠØªÙˆØ³: "Ù‡Ù†Ø§Ùƒ Ø£Ø´ÙŠØ§Ø¡ ÙÙŠ Ø³ÙŠØ·Ø±ØªÙ†Ø§ ÙˆØ£Ø´ÙŠØ§Ø¡ Ù„ÙŠØ³Øª ÙÙŠ Ø³ÙŠØ·Ø±ØªÙ†Ø§. ÙÙŠ Ø³ÙŠØ·Ø±ØªÙ†Ø§ Ø¢Ø±Ø§Ø¤Ù†Ø§ ÙˆØ±ØºØ¨Ø§ØªÙ†Ø§ ÙˆØ£ÙØ¹Ø§Ù„Ù†Ø§. ÙˆÙ„ÙŠØ³ ÙÙŠ Ø³ÙŠØ·Ø±ØªÙ†Ø§ Ø£Ø¬Ø³Ø§Ø¯Ù†Ø§ ÙˆÙ…Ù…ØªÙ„ÙƒØ§ØªÙ†Ø§ ÙˆØ³Ù…Ø¹ØªÙ†Ø§ ÙˆÙ…Ù†Ø§ØµØ¨Ù†Ø§." ÙÙ‡Ù… Ù‡Ø°Ø§ Ø§Ù„ØªÙ…ÙŠÙŠØ² ÙŠØ­Ø±Ø± Ø§Ù„Ø¥Ù†Ø³Ø§Ù† Ù…Ù† Ø§Ù„Ù‚Ù„Ù‚ ØºÙŠØ± Ø§Ù„Ù…Ø¨Ø±Ø±.',
            'source': 'Ø¥Ø¨ÙƒØªÙŠØªÙˆØ³ - Ø§Ù„ÙÙ„Ø³ÙØ© Ø§Ù„Ø±ÙˆØ§Ù‚ÙŠØ©',
            'tags': ['control', 'stoicism', 'anxiety', 'wisdom']
        },
        {
            'category': 'existentialism',
            'title': 'Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø¹Ù†Ù‰ - ÙÙŠÙƒØªÙˆØ± ÙØ±Ø§Ù†ÙƒÙ„',
            'content': 'ÙŠÙ‚ÙˆÙ„ ÙÙŠÙƒØªÙˆØ± ÙØ±Ø§Ù†ÙƒÙ„: "ÙƒÙ„ Ø´ÙŠØ¡ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙØ¤Ø®Ø° Ù…Ù† Ø§Ù„Ø¥Ù†Ø³Ø§Ù† Ø¥Ù„Ø§ Ø´ÙŠØ¦Ø§Ù‹ ÙˆØ§Ø­Ø¯Ø§Ù‹: Ø¢Ø®Ø± Ø§Ù„Ø­Ø±ÙŠØ§Øª Ø§Ù„Ø¥Ù†Ø³Ø§Ù†ÙŠØ© - Ø§Ù„Ù‚Ø¯Ø±Ø© Ø¹Ù„Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…ÙˆÙ‚ÙÙ‡ ÙÙŠ Ø£ÙŠ Ø¸Ø±ÙˆÙ Ù…Ø¹Ø·Ø§Ø©." Ø¥ÙŠØ¬Ø§Ø¯ Ø§Ù„Ù…Ø¹Ù†Ù‰ ÙÙŠ Ø§Ù„Ù…Ø¹Ø§Ù†Ø§Ø© ÙŠØ­ÙˆÙ„Ù‡Ø§ Ø¥Ù„Ù‰ Ø¥Ù†Ø¬Ø§Ø² Ø¥Ù†Ø³Ø§Ù†ÙŠ.',
            'source': 'ÙÙŠÙƒØªÙˆØ± ÙØ±Ø§Ù†ÙƒÙ„ - Ø§Ù„Ø¥Ù†Ø³Ø§Ù† ÙŠØ¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø¹Ù†Ù‰',
            'tags': ['meaning', 'purpose', 'suffering', 'choice']
        }
    ]
}

class AdvancedMentalHealthDatabase:
    """Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªÙ‚Ø¯Ù…Ø© Ù„Ù„ØµØ­Ø© Ø§Ù„Ù†ÙØ³ÙŠØ©"""

    def __init__(self):
        self.db_path = 'advanced_mental_health.db'
        self.init_database()

    def init_database(self):
        """Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©"""
        try:
            conn = sqlite3.connect(self.db_path)
            cursor = conn.cursor()

            # Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…ØªÙ‚Ø¯Ù…
            cursor.execute('''
            CREATE TABLE IF NOT EXISTS users (
                user_id INTEGER PRIMARY KEY,
                username TEXT,
                first_name TEXT,
                age INTEGER,
                gender TEXT,
                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                total_assessments INTEGER DEFAULT 0,
                risk_level TEXT DEFAULT 'unknown',
                bio TEXT,
                last_interaction TIMESTAMP,
                preferred_language TEXT DEFAULT 'ar'
            )
            ''')

            # Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª
            cursor.execute('''
            CREATE TABLE IF NOT EXISTS assessments (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                user_id INTEGER,
                session_id TEXT,
                assessment_type TEXT,
                questions_answers TEXT,
                total_score INTEGER,
                subscale_scores TEXT,
                risk_level TEXT,
                severity TEXT,
                timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                recommendations TEXT,
                islamic_guidance TEXT,
                follow_up_needed BOOLEAN,
                FOREIGN KEY (user_id) REFERENCES users (user_id)
            )
            ''')

            # Ø¬Ø¯ÙˆÙ„ ØªØ­Ù„ÙŠÙ„ MBTI
            cursor.execute('''
            CREATE TABLE IF NOT EXISTS mbti_results (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                user_id INTEGER,
                session_id TEXT,
                personality_type TEXT,
                dimension_scores TEXT,
                detailed_analysis TEXT,
                timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                FOREIGN KEY (user_id) REFERENCES users (user_id)
            )
            ''')

            # Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†ÙØ³ÙŠ Ø§Ù„Ø´Ø§Ù…Ù„
            cursor.execute('''
            CREATE TABLE IF NOT EXISTS psychological_evaluations (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                user_id INTEGER,
                session_id TEXT,
                evaluation_data TEXT,
                analysis_results TEXT,
                support_resources TEXT,
                timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                FOREIGN KEY (user_id) REFERENCES users (user_id)
            )
            ''')

            conn.commit()
            conn.close()
            logger.info("ğŸ—„ï¸ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© ØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡Ø§ Ø¨Ù†Ø¬Ø§Ø­")
        except Exception as e:
            logger.error(f"âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: {e}")

class PsychologicalAnalysisService:
    """Ø®Ø¯Ù…Ø© Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†ÙØ³ÙŠ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„Ø©"""

    @staticmethod
    def generate_user_id(telegram_user_id: str) -> str:
        """Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¹Ø±Ù Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø´ÙØ±"""
        return hashlib.sha256(f"user_{telegram_user_id}".encode()).hexdigest()[:32]

    @staticmethod
    def analyze_mbti(responses: dict) -> dict:
        """ØªØ­Ù„ÙŠÙ„ Ù†ØªØ§Ø¦Ø¬ Ø§Ø®ØªØ¨Ø§Ø± MBTI"""
        dimension_scores = {'E': 0, 'I': 0, 'S': 0, 'N': 0, 'T': 0, 'F': 0, 'J': 0, 'P': 0}

        # Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø· Ù„ÙƒÙ„ Ø¨Ø¹Ø¯
        for dimension, answers in responses.items():
            for answer in answers:
                if answer in dimension_scores:
                    dimension_scores[answer] += 1

        # ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù†Ù…Ø·
        personality_type = ""
        personality_type += 'E' if dimension_scores['E'] > dimension_scores['I'] else 'I'
        personality_type += 'S' if dimension_scores['S'] > dimension_scores['N'] else 'N'
        personality_type += 'T' if dimension_scores['T'] > dimension_scores['F'] else 'F'
        personality_type += 'J' if dimension_scores['J'] > dimension_scores['P'] else 'P'

        # Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù†Ù…Ø·
        personality_details = MBTI_TYPES.get(personality_type, {
            'name': 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',
            'description': 'Ù†Ù…Ø· Ø´Ø®ØµÙŠØ© ØºÙŠØ± Ù…ØµÙ†Ù',
            'strengths': [],
            'weaknesses': [],
            'careers': [],
            'advice': 'ØªØ­ØªØ§Ø¬ Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„ØªÙ‚ÙŠÙŠÙ…'
        })

        return {
            'personality_type': personality_type,
            'dimension_scores': dimension_scores,
            'details': personality_details,
            'confidence_score': min(max(
                abs(dimension_scores['J'] - dimension_scores['P']) / 12.0, 0.5), 1.0)
        }

    @staticmethod
    def analyze_psychological_evaluation(responses: dict) -> dict:
        """ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†ÙØ³ÙŠ Ø§Ù„Ø´Ø§Ù…Ù„"""
        analysis = {
            'risk_factors': [],
            'protective_factors': [],
            'recommendations': [],
            'support_needed': False
        }

        # ØªØ­Ù„ÙŠÙ„ ÙƒÙ„ ÙØ¦Ø©
        for category, answers in responses.items():
            if category == 'medical_history':
                analysis = PsychologicalAnalysisService._analyze_medical_history(answers, analysis)
            elif category == 'social_environment':
                analysis = PsychologicalAnalysisService._analyze_social_environment(answers, analysis)
            elif category == 'addiction_behaviors':
                analysis = PsychologicalAnalysisService._analyze_addiction_behaviors(answers, analysis)
            elif category == 'psychological_state':
                analysis = PsychologicalAnalysisService._analyze_psychological_state(answers, analysis)

        return analysis

    @staticmethod
    def _analyze_medical_history(answers: list, analysis: dict) -> dict:
        """ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ø¨ÙŠ"""
        for answer in answers:
            if 'Ù†Ø¹Ù…' in str(answer):
                analysis['risk_factors'].append('ÙˆØ¬ÙˆØ¯ ØªØ§Ø±ÙŠØ® Ø·Ø¨ÙŠ Ù‚Ø¯ ÙŠØ¤Ø«Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù†ÙØ³ÙŠØ©')
                analysis['recommendations'].append('Ø¶Ø±ÙˆØ±Ø© Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø·Ø¨ÙŠØ© Ø§Ù„Ù…Ù†ØªØ¸Ù…Ø©')
        return analysis

    @staticmethod
    def _analyze_social_environment(answers: list, analysis: dict) -> dict:
        """ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ¦Ø© Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©"""
        support_scores = [int(x) for x in answers if str(x).isdigit()]
        if support_scores:
            avg_support = sum(support_scores) / len(support_scores)
            if avg_support >= 4:
                analysis['protective_factors'].append('Ø¯Ø¹Ù… Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ ÙˆØ£Ø³Ø±ÙŠ Ù‚ÙˆÙŠ')
            elif avg_support <= 2:
                analysis['risk_factors'].append('Ø¶Ø¹Ù ÙÙŠ Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ')
                analysis['recommendations'].append('ØªØ·ÙˆÙŠØ± Ø´Ø¨ÙƒØ© Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ')
        return analysis

    @staticmethod
    def _analyze_addiction_behaviors(answers: list, analysis: dict) -> dict:
        """ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³Ù„ÙˆÙƒÙŠØ§Øª Ø§Ù„Ø¥Ø¯Ù…Ø§Ù†ÙŠØ©"""
        if 'Ù†Ø¹Ù…' in str(answers):
            analysis['risk_factors'].append('ÙˆØ¬ÙˆØ¯ Ø³Ù„ÙˆÙƒÙŠØ§Øª Ø¥Ø¯Ù…Ø§Ù†ÙŠØ© Ù…Ø­ØªÙ…Ù„Ø©')
            analysis['support_needed'] = True
            analysis['recommendations'].append('Ø·Ù„Ø¨ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ù…ØªØ®ØµØµØ© ÙÙŠ Ø¹Ù„Ø§Ø¬ Ø§Ù„Ø¥Ø¯Ù…Ø§Ù†')
        return analysis

    @staticmethod
    def _analyze_psychological_state(answers: list, analysis: dict) -> dict:
        """ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù†ÙØ³ÙŠØ©"""
        stress_scores = [int(x) for x in answers if str(x).isdigit()]
        if stress_scores:
            avg_stress = sum(stress_scores) / len(stress_scores)
            if avg_stress >= 4:
                analysis['risk_factors'].append('Ù…Ø³ØªÙˆÙ‰ ØªÙˆØªØ± Ø¹Ø§Ù„ÙŠ')
                analysis['recommendations'].append('ØªØ¹Ù„Ù… ØªÙ‚Ù†ÙŠØ§Øª Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙˆØªØ± ÙˆØ§Ù„Ø§Ø³ØªØ±Ø®Ø§Ø¡')
        return analysis

    @staticmethod
    def get_religious_support(analysis_results: dict) -> list:
        """Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„Ø¯ÙŠÙ†ÙŠ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨"""
        relevant_resources = []

        for resource in SUPPORT_RESOURCES['religious']:
            # ØªØ­Ø¯ÙŠØ¯ Ù…Ø¯Ù‰ Ø§Ù„ØµÙ„Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
            relevance = 0
            for tag in resource['tags']:
                if tag in str(analysis_results).lower():
                    relevance += 1

            if relevance > 0:
                relevant_resources.append({
                    **resource,
                    'relevance_score': relevance
                })

        # ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨ Ø§Ù„ØµÙ„Ø©
        relevant_resources.sort(key=lambda x: x['relevance_score'], reverse=True)
        return relevant_resources[:3]

    @staticmethod
    def get_philosophical_support(analysis_results: dict) -> list:
        """Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ„Ø³ÙÙŠ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨"""
        relevant_resources = []

        for resource in SUPPORT_RESOURCES['philosophical']:
            relevance = 0
            for tag in resource['tags']:
                if tag in str(analysis_results).lower():
                    relevance += 1

            if relevance > 0:
                relevant_resources.append({
                    **resource,
                    'relevance_score': relevance
                })

        relevant_resources.sort(key=lambda x: x['relevance_score'], reverse=True)
        return relevant_resources[:3]

class AdvancedMentalHealthBot:
    """Ø¨ÙˆØª Ø§Ù„ØµØ­Ø© Ø§Ù„Ù†ÙØ³ÙŠØ© Ø§Ù„Ù…ØªÙ‚Ø¯Ù… ÙˆØ§Ù„Ø´Ø§Ù…Ù„"""

    def __init__(self):
        self.db = AdvancedMentalHealthDatabase()
        self.analysis_service = PsychologicalAnalysisService()
        self.user_sessions = {}
        self.scheduler_task = None

    async def schedule_daily_quotes(self):
        """Ø¬Ø¯ÙˆÙ„Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø§Ù‚ØªØ¨Ø§Ø³Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©"""
        async def send_scheduled_quote():
            try:
                # Ù‡Ù†Ø§ ÙŠØªÙ… Ø¬Ù„Ø¨ Ø§Ù‚ØªØ¨Ø§Ø³ Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ù…Ø¹Ø±ÙØ©
                quote = self.get_random_quote()
                if quote:
                    bot = Bot(token=TOKEN)
                    await bot.send_message(chat_id=CHANNEL_ID, text=quote, parse_mode='Markdown')
                    logger.info(f"âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù‚ØªØ¨Ø§Ø³ ÙŠÙˆÙ…ÙŠ Ø¥Ù„Ù‰ Ø§Ù„Ù‚Ù†Ø§Ø©: {CHANNEL_ID}")
                else:
                    logger.warning("âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù‚ØªØ¨Ø§Ø³ Ù„Ø¥Ø±Ø³Ø§Ù„Ù‡ Ù„Ù„Ù‚Ù†Ø§Ø©.")
            except Exception as e:
                logger.error(f"âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø§Ù‚ØªØ¨Ø§Ø³ Ø§Ù„Ø¯ÙˆØ±ÙŠ: {e}")

        async def run_scheduler():
            while True:
                try:
                    now = datetime.now()
                    next_run = now + timedelta(hours=6)
                    next_run = next_run.replace(minute=0, second=0, microsecond=0)
                    wait_seconds = (next_run - now).total_seconds()
                    await asyncio.sleep(wait_seconds)
                    await send_scheduled_quote()
                except Exception as e:
                    logger.error(f"âŒ Ø®Ø·Ø£ ÙÙŠ Ø¬Ø¯ÙˆÙ„Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„: {e}")
                    await asyncio.sleep(3600)  # Ø§Ù†ØªØ¸Ø§Ø± Ø³Ø§Ø¹Ø© ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£

        # ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙˆÙ„Ø© ÙÙŠ Ù…Ù‡Ù…Ø© Ø®Ù„ÙÙŠØ©
        if not self.scheduler_task or self.scheduler_task.done():
            self.scheduler_task = asyncio.create_task(run_scheduler())

    def get_random_quote(self):
        """Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù‚ØªØ¨Ø§Ø³ Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ù…Ø¹Ø±ÙØ©"""
        all_quotes = []
        for category in KNOWLEDGE_DATABASE.values():
            for resource_type in category.values():
                if isinstance(resource_type, dict):
                    for quote_source in resource_type.values():
                        if isinstance(quote_source, dict):
                            if 'text' in quote_source:
                                all_quotes.append(f"*{quote_source['text']}* - {quote_source['source']}")
                            elif 'ayah' in quote_source:
                                all_quotes.append(f"*{quote_source['ayah']}* - {quote_source['reference']}\n{quote_source['tafseer']}")
                        elif isinstance(quote_source, str):
                            all_quotes.append(f"*{quote_source}*")

        # Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¯Ø¹Ù…
        for resource in SUPPORT_RESOURCES['religious']:
            all_quotes.append(f"*{resource['title']}*\n{resource['content'][:200]}...")

        for resource in SUPPORT_RESOURCES['philosophical']:
            all_quotes.append(f"*{resource['title']}*\n{resource['content'][:200]}...")

        if all_quotes:
            return random.choice(all_quotes)
        else:
            return "ğŸŒŸ *Ø­ÙƒÙ…Ø© Ø§Ù„ÙŠÙˆÙ…:* Ø§Ù„Ø­ÙŠØ§Ø© Ø±Ø­Ù„Ø©ØŒ Ø§Ø³ØªÙ…ØªØ¹ Ø¨ÙƒÙ„ Ø®Ø·ÙˆØ© ÙÙŠÙ‡Ø§"

    async def start_command(self, update: Update, context: ContextTypes.DEFAULT_TYPE):
        """Ø£Ù…Ø± Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù…Ø·ÙˆØ±"""
        try:
            user = update.effective_user

            # Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            self.save_user_data(user)

            welcome_text = f"""
ğŸŒŸ **Ø£Ù‡Ù„Ø§Ù‹ ÙˆØ³Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ {user.first_name}** ğŸŒŸ

ğŸ§  **Ù…Ø±ÙƒØ² Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†ÙØ³ÙŠ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„** ğŸ§ 

âœ¨ **Ø®Ø¯Ù…Ø§ØªÙ†Ø§ Ø§Ù„Ø´Ø§Ù…Ù„Ø©:**

ğŸ¯ **ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø´Ø®ØµÙŠØ© MBTI**
â€¢ Ø§ÙƒØªØ´Ù Ù†Ù…Ø· Ø´Ø®ØµÙŠØªÙƒ Ù…Ù† 16 Ù†Ù…Ø· Ù…Ø®ØªÙ„Ù
â€¢ ØªØ­Ù„ÙŠÙ„ Ù…ÙØµÙ„ Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù‚ÙˆØ© ÙˆØ§Ù„Ø¶Ø¹Ù
â€¢ ØªÙˆØ¬ÙŠÙ‡Ø§Øª Ù…Ù‡Ù†ÙŠØ© Ù…Ø®ØµØµØ©

ğŸ“Š **Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø©**
â€¢ Ù…Ù‚ÙŠØ§Ø³ Ø§Ù„Ø§ÙƒØªØ¦Ø§Ø¨ PHQ-9
â€¢ Ù…Ù‚ÙŠØ§Ø³ Ø§Ù„Ù‚Ù„Ù‚ GAD-7
â€¢ ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø£Ø®Ø±Ù‰ Ù…ØªØ®ØµØµØ©

ğŸ•Œ **Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„Ø±ÙˆØ­ÙŠ ÙˆØ§Ù„ÙÙ„Ø³ÙÙŠ**
â€¢ Ø¥Ø±Ø´Ø§Ø¯ Ø¥Ø³Ù„Ø§Ù…ÙŠ Ù…Ù† Ø§Ù„Ù‚Ø±Ø¢Ù† ÙˆØ§Ù„Ø³Ù†Ø©
â€¢ Ø­ÙƒÙ… ÙÙ„Ø³ÙÙŠØ© Ù…Ù† Ù…Ø®ØªÙ„Ù Ø§Ù„Ù…Ø¯Ø§Ø±Ø³
â€¢ Ø¯Ø¹Ù… Ù…Ø®ØµØµ Ø­Ø³Ø¨ Ø­Ø§Ù„ØªÙƒ

ğŸ’¡ **Ù…Ù…ÙŠØ²Ø§Øª Ø®Ø§ØµØ©:**
âœ… ØªØ­Ù„ÙŠÙ„ Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯
âœ… Ø®ØµÙˆØµÙŠØ© ÙˆØ£Ù…Ø§Ù† ØªØ§Ù…
âœ… ØªÙˆØµÙŠØ§Øª Ù…Ø®ØµØµØ©
âœ… Ø¯Ø¹Ù… Ù…Ø³ØªÙ…Ø± 24/7

ğŸš€ **Ø§Ø¨Ø¯Ø£ Ø±Ø­Ù„ØªÙƒ Ù†Ø­Ùˆ ÙÙ‡Ù… Ø£Ø¹Ù…Ù‚ Ù„Ø°Ø§ØªÙƒ!**
            """

            keyboard = [
                [InlineKeyboardButton("ğŸ§  ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø´Ø®ØµÙŠØ© MBTI", callback_data="start_mbti")],
                [InlineKeyboardButton("ğŸ“Š Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù†ÙØ³ÙŠØ©", callback_data="start_journey")],
                [InlineKeyboardButton("ğŸ” Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†ÙØ³ÙŠ Ø§Ù„Ø´Ø§Ù…Ù„", callback_data="start_psychological_evaluation")],
                [InlineKeyboardButton("â„¹ï¸ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø®Ø¯Ù…Ø©", callback_data="more_info")]
            ]

            await update.message.reply_text(
                welcome_text, 
                reply_markup=InlineKeyboardMarkup(keyboard),
                parse_mode='Markdown'
            )
        except Exception as e:
            logger.error(f"âŒ Ø®Ø·Ø£ ÙÙŠ Ø£Ù…Ø± Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©: {e}")
            await update.message.reply_text("Ø­Ø¯Ø« Ø®Ø·Ø£ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.")

    async def handle_callback(self, update: Update, context: ContextTypes.DEFAULT_TYPE):
        """Ù…Ø¹Ø§Ù„Ø¬ Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…"""
        try:
            query = update.callback_query
            await query.answer()

            data = query.data

            # ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªÙØ§Ø¹Ù„
            self.log_user_interaction(query.from_user.id, data)

            if data == "start_mbti":
                await self.start_mbti_assessment(query, context)
            elif data == "start_journey":
                await self.show_assessment_menu(query, context)
            elif data == "start_psychological_evaluation":
                await self.start_psychological_evaluation(query, context)
            elif data == "more_info":
                await self.show_detailed_info(query, context)
            elif data.startswith("mbti_"):
                await self.handle_mbti_response(query, context, data)
            elif data.startswith("assessment_"):
                await self.start_assessment(query, context, data)
            elif data.startswith("answer_"):
                await self.handle_assessment_answer(query, context, data)
            elif data.startswith("begin_"):
                assessment_type = data.replace("begin_", "")
                await self.begin_assessment(query, context, assessment_type)
            elif data.startswith("psych_"):
                await self.handle_psychological_response(query, context, data)
            elif data == "back_to_main":
                await self.start_command_from_callback(query, context)
            elif data == "show_religious_support":
                await self.show_religious_support(query, context)
            elif data == "show_philosophical_support":
                await self.show_philosophical_support(query, context)
        except Exception as e:
            logger.error(f"âŒ Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù€ callback: {e}")
            await query.edit_message_text("Ø­Ø¯Ø« Ø®Ø·Ø£ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.")

    async def start_mbti_assessment(self, query, context):
        """Ø¨Ø¯Ø¡ Ø§Ø®ØªØ¨Ø§Ø± ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø´Ø®ØµÙŠØ© MBTI"""
        try:
            intro_text = f"""
ğŸ§  **Ø§Ø®ØªØ¨Ø§Ø± ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø´Ø®ØµÙŠØ© Ù…Ø§ÙŠØ±Ø²-Ø¨Ø±ÙŠØºØ² (MBTI)**

ğŸ“– **Ø¹Ù† Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:**
Ù…Ø¤Ø´Ø± Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø´Ø®ØµÙŠØ© Ù…Ø§ÙŠØ±Ø²-Ø¨Ø±ÙŠØºØ² Ù‡Ùˆ Ø£Ø­Ø¯ Ø£Ù‚ÙˆÙ‰ Ø£Ø¯ÙˆØ§Øª ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø´Ø®ØµÙŠØ© ÙÙŠ Ø§Ù„Ø¹Ø§Ù„Ù…ØŒ Ø¨Ù…ØµØ¯Ø§Ù‚ÙŠØ© ØªØµÙ„ Ø¥Ù„Ù‰ 85%. ÙŠØ³Ø§Ø¹Ø¯Ùƒ Ø¹Ù„Ù‰:

ğŸ¯ **Ø³ØªÙƒØªØ´Ù:**
â€¢ Ù†Ù…Ø· Ø´Ø®ØµÙŠØªÙƒ Ù…Ù† 16 Ù†Ù…Ø· Ù…Ø®ØªÙ„Ù
â€¢ Ù†Ù‚Ø§Ø· Ù‚ÙˆØªÙƒ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠØ©
â€¢ Ø§Ù„Ù…Ø¬Ø§Ù„Ø§Øª Ø§Ù„ØªÙŠ ØªØ­ØªØ§Ø¬ ØªØ·ÙˆÙŠØ±
â€¢ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡Ø§Øª Ø§Ù„Ù…Ù‡Ù†ÙŠØ© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©

â° **Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹:** 10-15 Ø¯Ù‚ÙŠÙ‚Ø©
ğŸ¯ **Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©:** 12 Ø³Ø¤Ø§Ù„ (3 Ù„ÙƒÙ„ Ù…Ù‚ÙŠØ§Ø³)

ğŸ’¡ **Ù†ØµÙŠØ­Ø©:** Ø§Ø®ØªØ± Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØªÙŠ ØªØ¹ÙƒØ³ ØªÙØ¶ÙŠÙ„Ùƒ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠØŒ ÙˆÙ„ÙŠØ³ Ù…Ø§ ØªØ¹ØªÙ‚Ø¯ Ø£Ù†Ù‡ Ø§Ù„ØµØ­ÙŠØ­.

ğŸ”’ **Ø®ØµÙˆØµÙŠØªÙƒ Ù…Ø­Ù…ÙŠØ© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„**
            """

            session_id = str(uuid.uuid4())
            context.user_data['mbti_session'] = session_id
            context.user_data['mbti_responses'] = {}
            context.user_data['current_dimension'] = 'EI'
            context.user_data['current_question'] = 0

            keyboard = [
                [InlineKeyboardButton("ğŸš€ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±", callback_data="mbti_start_test")],
                [InlineKeyboardButton("ğŸ“š Ø§Ù„Ù…Ø²ÙŠØ¯ Ø¹Ù† MBTI", callback_data="mbti_more_info")],
                [InlineKeyboardButton("ğŸ”™ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©", callback_data="back_to_main")]
            ]

            await query.edit_message_text(
                intro_text,
                reply_markup=InlineKeyboardMarkup(keyboard),
                parse_mode='Markdown'
            )
        except Exception as e:
            logger.error(f"âŒ Ø®Ø·Ø£ ÙÙŠ Ø¨Ø¯Ø¡ MBTI: {e}")
            await query.edit_message_text("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.")

    async def handle_mbti_response(self, query, context, data):
        """Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ø®ØªØ¨Ø§Ø± MBTI"""
        try:
            if data == "mbti_start_test":
                await self.send_mbti_question(query, context)
            elif data == "mbti_more_info":
                await self.show_mbti_detailed_info(query, context)
            elif data.startswith("mbti_answer_"):
                parts = data.split("_")
                answer = parts[2]  # E, I, S, N, T, F, J, P

                # Ø­ÙØ¸ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©
                current_dim = context.user_data.get('current_dimension', 'EI')
                if 'mbti_responses' not in context.user_data:
                    context.user_data['mbti_responses'] = {}
                if current_dim not in context.user_data['mbti_responses']:
                    context.user_data['mbti_responses'][current_dim] = []
                context.user_data['mbti_responses'][current_dim].append(answer)

                # Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ
                await self.next_mbti_question(query, context)
        except Exception as e:
            logger.error(f"âŒ Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¥Ø¬Ø§Ø¨Ø© MBTI: {e}")
            await query.edit_message_text("Ø­Ø¯Ø« Ø®Ø·Ø£ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.")

    async def send_mbti_question(self, query, context):
        """Ø¥Ø±Ø³Ø§Ù„ Ø³Ø¤Ø§Ù„ MBTI"""
        try:
            current_dim = context.user_data.get('current_dimension', 'EI')
            current_q = context.user_data.get('current_question', 0)

            dimension_data = MBTI_ASSESSMENT['dimensions'][current_dim]

            if current_q >= len(dimension_data['questions']):
                await self.next_mbti_dimension(query, context)
                return

            question = dimension_data['questions'][current_q]

            progress = self.calculate_mbti_progress(context.user_data)
            progress_bar = "â–“" * int(progress // 10) + "â–‘" * (10 - int(progress // 10))

            question_text = f"""
ğŸ§  **ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø´Ø®ØµÙŠØ© MBTI**

ğŸ“Š **Ø§Ù„ØªÙ‚Ø¯Ù…:** {progress_bar} {progress:.0f}%

ğŸ¯ **Ø§Ù„Ù…Ù‚ÙŠØ§Ø³ Ø§Ù„Ø­Ø§Ù„ÙŠ:** {dimension_data['name']}
ğŸ’­ **Ø§Ù„ÙˆØµÙ:** {dimension_data['description']}

â“ **Ø§Ù„Ø³Ø¤Ø§Ù„ {current_q + 1}/3:**

**{question['text']}**

Ø§Ø®ØªØ± Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ø£Ù‚Ø±Ø¨ Ù„Ø·Ø¨ÙŠØ¹ØªÙƒ:
            """

            keyboard = []
            for i, option in enumerate(question['options']):
                callback_data = f"mbti_answer_{option['weight']}"
                keyboard.append([InlineKeyboardButton(option['text'], callback_data=callback_data)])

            await query.edit_message_text(
                question_text,
                reply_markup=InlineKeyboardMarkup(keyboard),
                parse_mode='Markdown'
            )
        except Exception as e:
            logger.error(f"âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø³Ø¤Ø§Ù„ MBTI: {e}")
            await query.edit_message_text("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø³Ø¤Ø§Ù„ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.")

    async def next_mbti_question(self, query, context):
        """Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ ÙÙŠ MBTI"""
        try:
            context.user_data['current_question'] += 1
            await self.send_mbti_question(query, context)
        except Exception as e:
            logger.error(f"âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ: {e}")

    async def next_mbti_dimension(self, query, context):
        """Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ø¨Ø¹Ø¯ Ø§Ù„ØªØ§Ù„ÙŠ ÙÙŠ MBTI"""
        try:
            dimensions = ['EI', 'SN', 'TF', 'JP']
            current_dim = context.user_data.get('current_dimension')
            current_index = dimensions.index(current_dim) if current_dim in dimensions else 0

            if current_index + 1 < len(dimensions):
                context.user_data['current_dimension'] = dimensions[current_index + 1]
                context.user_data['current_question'] = 0
                await self.send_mbti_question(query, context)
            else:
                await self.complete_mbti_assessment(query, context)
        except Exception as e:
            logger.error(f"âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ø¨Ø¹Ø¯ Ø§Ù„ØªØ§Ù„ÙŠ: {e}")

    def calculate_mbti_progress(self, user_data):
        """Ø­Ø³Ø§Ø¨ ØªÙ‚Ø¯Ù… Ø§Ø®ØªØ¨Ø§Ø± MBTI"""
        total_questions = 12  # 3 Ø£Ø³Ø¦Ù„Ø© Ã— 4 Ø£Ø¨Ø¹Ø§Ø¯
        answered_questions = 0

        for dim, responses in user_data.get('mbti_responses', {}).items():
            answered_questions += len(responses)

        current_q = user_data.get('current_question', 0)
        answered_questions += current_q

        return (answered_questions / total_questions) * 100

    async def complete_mbti_assessment(self, query, context):
        """Ø¥ÙƒÙ…Ø§Ù„ Ø§Ø®ØªØ¨Ø§Ø± MBTI ÙˆØ¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬"""
        try:
            responses = context.user_data.get('mbti_responses', {})
            user_id = query.from_user.id
            session_id = context.user_data.get('mbti_session')

            # ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
            analysis = self.analysis_service.analyze_mbti(responses)

            # Ø­ÙØ¸ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
            self.save_mbti_results(user_id, session_id, analysis)

            personality_type = analysis['personality_type']
            details = analysis['details']
            confidence = analysis['confidence_score']

            results_text = f"""
ğŸ§  **Ù†ØªØ§Ø¦Ø¬ ØªØ­Ù„ÙŠÙ„ Ø´Ø®ØµÙŠØªÙƒ MBTI**

ğŸ¯ **Ù†Ù…Ø· Ø´Ø®ØµÙŠØªÙƒ:** {personality_type}
ğŸ‘‘ **Ø§Ù„Ù„Ù‚Ø¨:** {details['name']}

ğŸ“ **Ø§Ù„ÙˆØµÙ:**
{details['description']}

ğŸ’ª **Ù†Ù‚Ø§Ø· Ø§Ù„Ù‚ÙˆØ©:**
{chr(10).join(f"â€¢ {strength}" for strength in details['strengths'])}

âš ï¸ **Ù†Ù‚Ø§Ø· Ø§Ù„ØªØ·ÙˆÙŠØ±:**
{chr(10).join(f"â€¢ {weakness}" for weakness in details['weaknesses'])}

ğŸ’¼ **Ø§Ù„Ù…Ù‡Ù† Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©:**
{chr(10).join(f"â€¢ {career}" for career in details['careers'])}

ğŸ’¡ **Ù†ØµÙŠØ­Ø© Ø´Ø®ØµÙŠØ©:**
{details['advice']}

ğŸ“Š **Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø«Ù‚Ø© ÙÙŠ Ø§Ù„Ù†ØªÙŠØ¬Ø©:** {confidence:.1%}

ğŸŒŸ **ØªØ°ÙƒØ±:** Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†Ù…Ø· Ø£ÙØ¶Ù„ Ù…Ù† Ø¢Ø®Ø±ØŒ ÙƒÙ„ Ù†Ù…Ø· Ù„Ù‡ Ù…Ù…ÙŠØ²Ø§ØªÙ‡ Ø§Ù„ÙØ±ÙŠØ¯Ø©!
            """

            keyboard = [
                [InlineKeyboardButton("ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±", callback_data="start_mbti")],
                [InlineKeyboardButton("ğŸ  Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©", callback_data="back_to_main")]
            ]

            await query.edit_message_text(
                results_text,
                reply_markup=InlineKeyboardMarkup(keyboard),
                parse_mode='Markdown'
            )
        except Exception as e:
            logger.error(f"âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥ÙƒÙ…Ø§Ù„ ØªØ­Ù„ÙŠÙ„ MBTI: {e}")
            await query.edit_message_text("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.")

    async def start_psychological_evaluation(self, query, context):
        """Ø¨Ø¯Ø¡ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†ÙØ³ÙŠ Ø§Ù„Ø´Ø§Ù…Ù„"""
        try:
            intro_text = f"""
ğŸ” **Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†ÙØ³ÙŠ Ø§Ù„Ø´Ø§Ù…Ù„ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„**

ğŸ“‹ **Ù…Ø§ Ù‡Ùˆ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†ÙØ³ÙŠØŸ**
Ù‡Ùˆ ÙØ­Øµ Ø´Ø§Ù…Ù„ ÙŠØ¬Ù…Ø¹ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¹Ù† Ø´Ø®ØµÙŠØªÙƒ Ø¶Ù…Ù† Ø®Ø¯Ù…Ø© Ù†ÙØ³ÙŠØ© Ù…ØªÙƒØ§Ù…Ù„Ø© Ù„Ø¥Ø¬Ø±Ø§Ø¡ ØªÙ‚ÙŠÙŠÙ… Ø¯Ù‚ÙŠÙ‚ Ù„Ø­Ø§Ù„ØªÙƒ Ø§Ù„Ù†ÙØ³ÙŠØ© ÙˆØ§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©.

ğŸ¯ **Ù…Ø§ ÙŠØ´Ù…Ù„Ù‡ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…:**

1ï¸âƒ£ **Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ø¨ÙŠ**
â€¢ Ø§Ù„Ø£Ù…Ø±Ø§Ø¶ Ø§Ù„Ù…Ø²Ù…Ù†Ø©
â€¢ Ø§Ù„Ø£Ø¯ÙˆÙŠØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©
â€¢ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†ÙØ³ÙŠ Ø§Ù„Ø³Ø§Ø¨Ù‚

2ï¸âƒ£ **Ø§Ù„Ø¨ÙŠØ¦Ø© Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©**
â€¢ Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„Ø£Ø³Ø±ÙŠ
â€¢ Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©
â€¢ Ø§Ù„Ø¶ØºÙˆØ· Ø§Ù„Ø¨ÙŠØ¦ÙŠØ©

3ï¸âƒ£ **ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø³Ù„ÙˆÙƒÙŠØ§Øª**
â€¢ Ø§Ù„Ø³Ù„ÙˆÙƒÙŠØ§Øª Ø§Ù„Ø¶Ø§Ø±Ø© Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø©
â€¢ Ø£Ù†Ù…Ø§Ø· Ø§Ù„ØªØ£Ù‚Ù„Ù…
â€¢ Ø¢Ù„ÙŠØ§Øª Ø§Ù„Ø¯ÙØ§Ø¹ Ø§Ù„Ù†ÙØ³ÙŠ

4ï¸âƒ£ **Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù†ÙØ³ÙŠØ© Ø§Ù„Ø¹Ø§Ù…Ø©**
â€¢ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªÙˆØªØ±
â€¢ Ø§Ù„Ù…Ø²Ø§Ø¬ Ø§Ù„Ø¹Ø§Ù…
â€¢ Ø§Ù„Ù‚Ø¯Ø±Ø© Ø¹Ù„Ù‰ Ø§Ù„ØªØ£Ù‚Ù„Ù…

ğŸ“Š **Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø³ØªØ´Ù…Ù„:**
â€¢ ØªØ­Ù„ÙŠÙ„ Ù†ÙØ³ÙŠ Ù…ØªÙƒØ§Ù…Ù„
â€¢ ØªØ­Ø¯ÙŠØ¯ Ø¹ÙˆØ§Ù…Ù„ Ø§Ù„Ø®Ø·Ø± ÙˆØ§Ù„Ø­Ù…Ø§ÙŠØ©
â€¢ ØªÙˆØµÙŠØ§Øª Ø¹Ù„Ø§Ø¬ÙŠØ© Ù…Ø®ØµØµØ©
â€¢ Ø¯Ø¹Ù… Ø¯ÙŠÙ†ÙŠ ÙˆÙÙ„Ø³ÙÙŠ Ù…Ù†Ø§Ø³Ø¨

â° **Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹:** 15-20 Ø¯Ù‚ÙŠÙ‚Ø©
ğŸ”’ **Ø³Ø±ÙŠØ© ØªØ§Ù…Ø© ÙˆÙ…Ø­Ù…ÙŠØ© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„**

âš ï¸ **ØªÙ†Ø¨ÙŠÙ‡ Ù…Ù‡Ù…:** Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ù„Ø£ØºØ±Ø§Ø¶ Ø§Ù„ØªÙˆØ¹ÙŠØ© ÙˆØ§Ù„Ø¯Ø¹Ù… Ø§Ù„Ù†ÙØ³ÙŠØŒ ÙˆÙ„ÙŠØ³ Ø¨Ø¯ÙŠÙ„Ø§Ù‹ Ø¹Ù† Ø§Ù„Ø§Ø³ØªØ´Ø§Ø±Ø© Ø§Ù„Ø·Ø¨ÙŠØ© Ø§Ù„Ù…ØªØ®ØµØµØ©.
            """

            session_id = str(uuid.uuid4())
            context.user_data['psych_session'] = session_id
            context.user_data['psych_responses'] = {}
            context.user_data['current_category'] = 'medical_history'
            context.user_data['current_psych_question'] = 0

            keyboard = [
                [InlineKeyboardButton("ğŸš€ Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…", callback_data="psych_start_evaluation")],
                [InlineKeyboardButton("ğŸ“š Ø§Ù„Ù…Ø²ÙŠØ¯ Ø¹Ù† Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†ÙØ³ÙŠ", callback_data="psych_more_info")],
                [InlineKeyboardButton("ğŸ”™ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©", callback_data="back_to_main")]
            ]

            await query.edit_message_text(
                intro_text,
                reply_markup=InlineKeyboardMarkup(keyboard),
                parse_mode='Markdown'
            )
        except Exception as e:
            logger.error(f"âŒ Ø®Ø·Ø£ ÙÙŠ Ø¨Ø¯Ø¡ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†ÙØ³ÙŠ: {e}")
            await query.edit_message_text("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¨Ø¯Ø¡ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.")

    async def handle_psychological_response(self, query, context, data):
        """Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†ÙØ³ÙŠ"""
        try:
            if data == "psych_start_evaluation":
                await self.send_psychological_question(query, context)
            elif data == "psych_more_info":
                await self.show_psychological_detailed_info(query, context)
            elif data.startswith("psych_answer_"):
                answer = data.replace("psych_answer_", "")

                # Ø­ÙØ¸ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©
                current_cat = context.user_data.get('current_category')
                if 'psych_responses' not in context.user_data:
                    context.user_data['psych_responses'] = {}
                if current_cat not in context.user_data['psych_responses']:
                    context.user_data['psych_responses'][current_cat] = []
                context.user_data['psych_responses'][current_cat].append(answer)

                # Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ
                await self.next_psychological_question(query, context)
        except Exception as e:
            logger.error(f"âŒ Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†ÙØ³ÙŠ: {e}")
            await query.edit_message_text("Ø­Ø¯Ø« Ø®Ø·Ø£ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.")

    async def send_psychological_question(self, query, context):
        """Ø¥Ø±Ø³Ø§Ù„ Ø³Ø¤Ø§Ù„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†ÙØ³ÙŠ"""
        try:
            current_cat = context.user_data.get('current_category')
            current_q = context.user_data.get('current_psych_question', 0)

            questions = PSYCHOLOGICAL_QUESTIONS.get(current_cat, [])

            if current_q >= len(questions):
                await self.next_psychological_category(query, context)
                return

            question = questions[current_q]

            # Ø­Ø³Ø§Ø¨ Ø§Ù„ØªÙ‚Ø¯Ù…
            total_questions = sum(len(PSYCHOLOGICAL_QUESTIONS[cat]) for cat in PSYCHOLOGICAL_QUESTIONS)
            completed_questions = sum(len(context.user_data.get('psych_responses', {}).get(cat, [])) for cat in context.user_data.get('psych_responses', {}))
            progress = (completed_questions / total_questions) * 100
            progress_bar = "â–“" * int(progress // 10) + "â–‘" * (10 - int(progress // 10))

            category_names = {
                'medical_history': 'Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ø¨ÙŠ',
                'social_environment': 'Ø§Ù„Ø¨ÙŠØ¦Ø© Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©',
                'addiction_behaviors': 'Ø§Ù„Ø³Ù„ÙˆÙƒÙŠØ§Øª Ø§Ù„Ø¥Ø¯Ù…Ø§Ù†ÙŠØ©',
                'psychological_state': 'Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù†ÙØ³ÙŠØ©'
            }

            question_text = f"""
ğŸ” **Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†ÙØ³ÙŠ Ø§Ù„Ø´Ø§Ù…Ù„**

ğŸ“Š **Ø§Ù„ØªÙ‚Ø¯Ù…:** {progress_bar} {progress:.0f}%

ğŸ“‹ **Ø§Ù„ÙØ¦Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©:** {category_names.get(current_cat, current_cat)}

â“ **{question['question']}**

Ø§Ø®ØªØ± Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©:
            """

            keyboard = []
            if question['type'] == 'multiple_choice':
                for option in question['options']:
                    callback_data = f"psych_answer_{option}"
                    keyboard.append([InlineKeyboardButton(option, callback_data=callback_data)])
            elif question['type'] == 'scale':
                for i in range(question['scale_min'], question['scale_max'] + 1):
                    label = question['scale_labels'][i-1] if i-1 < len(question['scale_labels']) else str(i)
                    callback_data = f"psych_answer_{i}"
                    keyboard.append([InlineKeyboardButton(f"{i} - {label}", callback_data=callback_data)])

            await query.edit_message_text(
                question_text,
                reply_markup=InlineKeyboardMarkup(keyboard),
                parse_mode='Markdown'
            )
        except Exception as e:
            logger.error(f"âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø³Ø¤Ø§Ù„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†ÙØ³ÙŠ: {e}")
            await query.edit_message_text("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø³Ø¤Ø§Ù„ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.")

    async def next_psychological_question(self, query, context):
        """Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ ÙÙŠ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†ÙØ³ÙŠ"""
        try:
            context.user_data['current_psych_question'] += 1
            await self.send_psychological_question(query, context)
        except Exception as e:
            logger.error(f"âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ: {e}")

    async def next_psychological_category(self, query, context):
        """Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„ÙØ¦Ø© Ø§Ù„ØªØ§Ù„ÙŠØ© ÙÙŠ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†ÙØ³ÙŠ"""
        try:
            categories = ['medical_history', 'social_environment', 'addiction_behaviors', 'psychological_state']
            current_cat = context.user_data.get('current_category')
            current_index = categories.index(current_cat) if current_cat in categories else 0

            if current_index + 1 < len(categories):
                context.user_data['current_category'] = categories[current_index + 1]
                context.user_data['current_psych_question'] = 0
                await self.send_psychological_question(query, context)
            else:
                await self.complete_psychological_evaluation(query, context)
        except Exception as e:
            logger.error(f"âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„ÙØ¦Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©: {e}")

    async def complete_psychological_evaluation(self, query, context):
        """Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†ÙØ³ÙŠ ÙˆØ¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬"""
        try:
            responses = context.user_data.get('psych_responses', {})
            user_id = query.from_user.id
            session_id = context.user_data.get('psych_session')

            # ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
            analysis = self.analysis_service.analyze_psychological_evaluation(responses)

            # Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„Ø±ÙˆØ­ÙŠ ÙˆØ§Ù„ÙÙ„Ø³ÙÙŠ
            religious_support = self.analysis_service.get_religious_support(analysis)
            philosophical_support = self.analysis_service.get_philosophical_support(analysis)

            # Ø­ÙØ¸ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
            self.save_psychological_results(user_id, session_id, {
                'responses': responses,
                'analysis': analysis,
                'religious_support': religious_support,
                'philosophical_support': philosophical_support
            })

            results_text = f"""
ğŸ” **Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†ÙØ³ÙŠ Ø§Ù„Ø´Ø§Ù…Ù„**

ğŸ“Š **Ù…Ù„Ø®Øµ Ø§Ù„ØªØ­Ù„ÙŠÙ„:**

ğŸ”´ **Ø¹ÙˆØ§Ù…Ù„ Ø§Ù„Ø®Ø·Ø± Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©:**
{chr(10).join(f"â€¢ {factor}" for factor in analysis['risk_factors']) if analysis['risk_factors'] else "â€¢ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹ÙˆØ§Ù…Ù„ Ø®Ø·Ø± ÙˆØ§Ø¶Ø­Ø©"}

ğŸŸ¢ **Ø§Ù„Ø¹ÙˆØ§Ù…Ù„ Ø§Ù„ÙˆÙ‚Ø§Ø¦ÙŠØ©:**
{chr(10).join(f"â€¢ {factor}" for factor in analysis['protective_factors']) if analysis['protective_factors'] else "â€¢ ÙŠØ­ØªØ§Ø¬ ØªØ¹Ø²ÙŠØ² Ø§Ù„Ø¹ÙˆØ§Ù…Ù„ Ø§Ù„ÙˆÙ‚Ø§Ø¦ÙŠØ©"}

ğŸ’¡ **Ø§Ù„ØªÙˆØµÙŠØ§Øª Ø§Ù„Ø¹Ù„Ø§Ø¬ÙŠØ©:**
{chr(10).join(f"â€¢ {rec}" for rec in analysis['recommendations']) if analysis['recommendations'] else "â€¢ Ø§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø± ÙÙŠ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠØ© Ù…Ø¹ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©"}

âš ï¸ **Ø§Ù„Ø­Ø§Ø¬Ø© Ù„Ù„Ø¯Ø¹Ù… Ø§Ù„Ù…ØªØ®ØµØµ:** {"Ù†Ø¹Ù… - ÙŠÙÙ†ØµØ­ Ø¨Ø·Ù„Ø¨ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ù…Ù‡Ù†ÙŠØ©" if analysis['support_needed'] else "Ù„Ø§ - Ø§Ù„Ø­Ø§Ù„Ø© Ù…Ø³ØªÙ‚Ø±Ø© Ø­Ø§Ù„ÙŠØ§Ù‹"}

ğŸŒŸ **Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø§Ù„ØªØ§Ù„ÙŠØ©:**
1. Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ØªÙˆØµÙŠØ§Øª Ø¨Ø¹Ù†Ø§ÙŠØ©
2. ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©
3. Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø¯ÙˆØ±ÙŠØ© Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ØªØ­Ø³Ù†

âš ï¸ **Ù…Ù„Ø§Ø­Ø¸Ø© Ù…Ù‡Ù…Ø©:** Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ù„ÙŠØ³ Ø¨Ø¯ÙŠÙ„Ø§Ù‹ Ø¹Ù† Ø§Ù„Ø§Ø³ØªØ´Ø§Ø±Ø© Ø§Ù„Ø·Ø¨ÙŠØ© Ø§Ù„Ù…ØªØ®ØµØµØ©
            """

            # Ø­ÙØ¸ Ø§Ù„Ø¯Ø¹Ù… ÙÙŠ context Ù„Ø¹Ø±Ø¶Ù‡ Ù„Ø§Ø­Ù‚Ø§Ù‹
            context.user_data['religious_support'] = religious_support
            context.user_data['philosophical_support'] = philosophical_support

            keyboard = [
                [InlineKeyboardButton("ğŸ•Œ Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„Ø¯ÙŠÙ†ÙŠ", callback_data="show_religious_support")],
                [InlineKeyboardButton("ğŸ“š Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ„Ø³ÙÙŠ", callback_data="show_philosophical_support")],
                [InlineKeyboardButton("ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ…", callback_data="start_psychological_evaluation")],
                [InlineKeyboardButton("ğŸ  Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©", callback_data="back_to_main")]
            ]

            await query.edit_message_text(
                results_text,
                reply_markup=InlineKeyboardMarkup(keyboard),
                parse_mode='Markdown'
            )
        except Exception as e:
            logger.error(f"âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†ÙØ³ÙŠ: {e}")
            await query.edit_message_text("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.")

    async def show_religious_support(self, query, context):
        """Ø¹Ø±Ø¶ Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„Ø¯ÙŠÙ†ÙŠ"""
        try:
            religious_support = context.user_data.get('religious_support', [])

            if not religious_support:
                text = "ğŸ•Œ **Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„Ø¯ÙŠÙ†ÙŠ Ø§Ù„Ø¹Ø§Ù…**\n\nÙ„Ø§ ØªÙˆØ¬Ø¯ ØªÙˆØµÙŠØ§Øª Ø¯ÙŠÙ†ÙŠØ© Ù…Ø­Ø¯Ø¯Ø©ØŒ ÙˆÙ„ÙƒÙ† Ù†Ù†ØµØ­ Ø¨Ø§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø± ÙÙŠ Ø§Ù„Ø°ÙƒØ± ÙˆØ§Ù„Ø¯Ø¹Ø§Ø¡."
            else:
                text = "ğŸ•Œ **Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„Ø¯ÙŠÙ†ÙŠ Ø§Ù„Ù…Ø®ØµØµ Ù„Ø­Ø§Ù„ØªÙƒ**\n\n"
                for i, resource in enumerate(religious_support[:3], 1):
                    text += f"**{i}. {resource['title']}**\n"
                    text += f"{resource['content'][:300]}...\n\n"
                    text += f"ğŸ“š *{resource['source']}*\n\n"

            keyboard = [
                [InlineKeyboardButton("ğŸ“š Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ„Ø³ÙÙŠ", callback_data="show_philosophical_support")],
                [InlineKeyboardButton("ğŸ”™ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù†ØªØ§Ø¦Ø¬", callback_data="start_psychological_evaluation")],
                [InlineKeyboardButton("ğŸ  Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©", callback_data="back_to_main")]
            ]

            await query.edit_message_text(
                text,
                reply_markup=InlineKeyboardMarkup(keyboard),
                parse_mode='Markdown'
            )
        except Exception as e:
            logger.error(f"âŒ Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„Ø¯ÙŠÙ†ÙŠ: {e}")
            await query.edit_message_text("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„Ø¯ÙŠÙ†ÙŠ.")

    async def show_philosophical_support(self, query, context):
        """Ø¹Ø±Ø¶ Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ„Ø³ÙÙŠ"""
        try:
            philosophical_support = context.user_data.get('philosophical_support', [])

            if not philosophical_support:
                text = "ğŸ“š **Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ„Ø³ÙÙŠ Ø§Ù„Ø¹Ø§Ù…**\n\nÙ„Ø§ ØªÙˆØ¬Ø¯ ØªÙˆØµÙŠØ§Øª ÙÙ„Ø³ÙÙŠØ© Ù…Ø­Ø¯Ø¯Ø©ØŒ ÙˆÙ„ÙƒÙ† Ù†Ù†ØµØ­ Ø¨Ø§Ù„ØªØ£Ù…Ù„ ÙÙŠ Ù…Ø¹Ù†Ù‰ Ø§Ù„Ø­ÙŠØ§Ø© ÙˆØ§Ù„Ø³Ø¹ÙŠ Ù„Ù„ØªØ·ÙˆÙŠØ± Ø§Ù„Ø°Ø§ØªÙŠ."
            else:
                text = "ğŸ“š **Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ„Ø³ÙÙŠ Ø§Ù„Ù…Ø®ØµØµ Ù„Ø­Ø§Ù„ØªÙƒ**\n\n"
                for i, resource in enumerate(philosophical_support[:3], 1):
                    text += f"**{i}. {resource['title']}**\n"
                    text += f"{resource['content'][:300]}...\n\n"
                    text += f"ğŸ“– *{resource['source']}*\n\n"

            keyboard = [
                [InlineKeyboardButton("ğŸ•Œ Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„Ø¯ÙŠÙ†ÙŠ", callback_data="show_religious_support")],
                [InlineKeyboardButton("ğŸ”™ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù†ØªØ§Ø¦Ø¬", callback_data="start_psychological_evaluation")],
                [InlineKeyboardButton("ğŸ  Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©", callback_data="back_to_main")]
            ]

            await query.edit_message_text(
                text,
                reply_markup=InlineKeyboardMarkup(keyboard),
                parse_mode='Markdown'
            )
        except Exception as e:
            logger.error(f"âŒ Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ„Ø³ÙÙŠ: {e}")
            await query.edit_message_text("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ„Ø³ÙÙŠ.")

    async def show_assessment_menu(self, query, context):
        """Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù†ÙØ³ÙŠØ© Ø§Ù„ØªÙ‚Ù„ÙŠØ¯ÙŠØ©"""
        try:
            menu_text = """
ğŸ“Š **Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù†ÙØ³ÙŠØ© Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø©**

ğŸ¯ **Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©:**

ğŸ˜” **Ù…Ù‚ÙŠØ§Ø³ Ø§Ù„Ø§ÙƒØªØ¦Ø§Ø¨ (PHQ-9)**
â€¢ Ø§Ù„Ù…Ø¹ÙŠØ§Ø± Ø§Ù„Ø°Ù‡Ø¨ÙŠ Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø§ÙƒØªØ¦Ø§Ø¨
â€¢ 9 Ø£Ø³Ø¦Ù„Ø© Ø¹Ù„Ù…ÙŠØ© Ø¯Ù‚ÙŠÙ‚Ø©
â€¢ ÙŠØ³ØªØ®Ø¯Ù… ÙÙŠ Ø§Ù„Ù…Ø³ØªØ´ÙÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ©

ğŸ˜° **Ù…Ù‚ÙŠØ§Ø³ Ø§Ù„Ù‚Ù„Ù‚ Ø§Ù„Ø¹Ø§Ù… (GAD-7)**
â€¢ Ù…Ù‚ÙŠØ§Ø³ Ø§Ù„Ù‚Ù„Ù‚ Ø§Ù„Ù…Ø¹ØªÙ…Ø¯ Ø¯ÙˆÙ„ÙŠØ§Ù‹
â€¢ 7 Ø£Ø³Ø¦Ù„Ø© Ø´Ø§Ù…Ù„Ø©
â€¢ ØªÙ‚ÙŠÙŠÙ… Ø¯Ù‚ÙŠÙ‚ Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù‚Ù„Ù‚

ğŸ’¡ **Ù‡Ø°Ù‡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª ØªÙƒÙ…Ù„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø§Ù„Ø´Ø§Ù…Ù„Ø© Ø§Ù„Ø£Ø®Ø±Ù‰**
            """

            keyboard = [
                [InlineKeyboardButton("ğŸ˜” Ù…Ù‚ÙŠØ§Ø³ Ø§Ù„Ø§ÙƒØªØ¦Ø§Ø¨ PHQ-9", callback_data="assessment_phq9")],
                [InlineKeyboardButton("ğŸ˜° Ù…Ù‚ÙŠØ§Ø³ Ø§Ù„Ù‚Ù„Ù‚ GAD-7", callback_data="assessment_gad7")],
                [InlineKeyboardButton("ğŸ”™ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©", callback_data="back_to_main")]
            ]

            await query.edit_message_text(
                menu_text,
                reply_markup=InlineKeyboardMarkup(keyboard),
                parse_mode='Markdown'
            )
        except Exception as e:
            logger.error(f"âŒ Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª: {e}")
            await query.edit_message_text("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©.")

    async def start_assessment(self, query, context, assessment_type):
        """Ø¨Ø¯Ø¡ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø­Ø¯Ø¯"""
        try:
            assessment_key = assessment_type.replace("assessment_", "")
            assessment = PSYCHOLOGICAL_ASSESSMENTS[assessment_key]

            context.user_data['current_assessment'] = assessment_key
            context.user_data['question_index'] = 0
            context.user_data['answers'] = []
            context.user_data['start_time'] = datetime.now()

            intro_text = f"""
{assessment['icon']} **{assessment['name']}**

ğŸ¯ **ØªØ¹Ù„ÙŠÙ…Ø§Øª Ù…Ù‡Ù…Ø©:**
â€¢ Ø§Ù‚Ø±Ø£ ÙƒÙ„ Ø³Ø¤Ø§Ù„ Ø¨Ø¹Ù†Ø§ÙŠØ©
â€¢ Ø§Ø®ØªØ± Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ø£ÙƒØ«Ø± ØµØ¯Ù‚Ø§Ù‹
â€¢ ÙÙƒØ± ÙÙŠ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠÙ† Ø§Ù„Ù…Ø§Ø¶ÙŠÙŠÙ†
â€¢ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¬Ø§Ø¨Ø§Øª ØµØ­ÙŠØ­Ø© Ø£Ùˆ Ø®Ø§Ø·Ø¦Ø©
â€¢ Ø§Ù„ØµØ¯Ù‚ Ù…Ø¹ Ø§Ù„Ù†ÙØ³ Ù‡Ùˆ Ø§Ù„Ù…ÙØªØ§Ø­

â° **Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹:** 5-7 Ø¯Ù‚Ø§Ø¦Ù‚

ğŸ”’ **Ø®ØµÙˆØµÙŠØªÙƒ Ù…Ø¶Ù…ÙˆÙ†Ø© 100%**

ğŸ’ª **Ø£Ù†Øª ØªØ®Ø·Ùˆ Ø®Ø·ÙˆØ© Ø´Ø¬Ø§Ø¹Ø© Ù†Ø­Ùˆ Ø§Ù„ØªØ­Ø³Ù†!**

Ù‡Ù„ Ø£Ù†Øª Ù…Ø³ØªØ¹Ø¯ Ù„Ù„Ø¨Ø¯Ø§ÙŠØ©ØŸ
            """

            keyboard = [
                [InlineKeyboardButton("ğŸš€ Ù†Ø¹Ù…ØŒ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¢Ù†", callback_data=f"begin_{assessment_key}")],
                [InlineKeyboardButton("ğŸ”™ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©", callback_data="start_journey")]
            ]

            await query.edit_message_text(
                intro_text,
                reply_markup=InlineKeyboardMarkup(keyboard),
                parse_mode='Markdown'
            )
        except Exception as e:
            logger.error(f"âŒ Ø®Ø·Ø£ ÙÙŠ Ø¨Ø¯Ø¡ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…: {e}")
            await query.edit_message_text("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¨Ø¯Ø¡ Ø§Ù„ØªÙ‚ÙŠÙŠÙ….")

    async def begin_assessment(self, query, context, assessment_type):
        """Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙØ¹Ù„ÙŠ"""
        try:
            context.user_data['current_assessment'] = assessment_type
            context.user_data['question_index'] = 0
            context.user_data['answers'] = []
            await self.send_assessment_question(query, context)
        except Exception as e:
            logger.error(f"âŒ Ø®Ø·Ø£ ÙÙŠ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±: {e}")
            await query.edit_message_text("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±.")

    async def send_assessment_question(self, query, context):
        """Ø¥Ø±Ø³Ø§Ù„ Ø³Ø¤Ø§Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±"""
        try:
            assessment_type = context.user_data['current_assessment']
            question_index = context.user_data['question_index']
            assessment = PSYCHOLOGICAL_ASSESSMENTS[assessment_type]

            if question_index >= len(assessment['questions']):
                await self.complete_assessment(query, context)
                return

            question = assessment['questions'][question_index]
            progress = ((question_index + 1) / len(assessment['questions'])) * 100

            question_text = f"""
{assessment['icon']} **{assessment['name']}**

ğŸ“Š **Ø§Ù„ØªÙ‚Ø¯Ù…:** {progress:.0f}%
ğŸ”¢ **Ø§Ù„Ø³Ø¤Ø§Ù„ {question_index + 1} Ù…Ù† {len(assessment['questions'])}**

â“ **Ø®Ù„Ø§Ù„ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠÙ† Ø§Ù„Ù…Ø§Ø¶ÙŠÙŠÙ†ØŒ ÙƒÙ… Ù…Ø±Ø© Ø§Ù†Ø²Ø¹Ø¬Øª Ù…Ù†:**

**{question}**

Ø§Ø®ØªØ± Ø¥Ø¬Ø§Ø¨ØªÙƒ:
            """

            keyboard = []
            for option_text, score in assessment['options']:
                callback_data = f"answer_{score}"
                keyboard.append([InlineKeyboardButton(option_text, callback_data=callback_data)])

            await query.edit_message_text(
                question_text,
                reply_markup=InlineKeyboardMarkup(keyboard),
                parse_mode='Markdown'
            )
        except Exception as e:
            logger.error(f"âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø³Ø¤Ø§Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±: {e}")
            await query.edit_message_text("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø³Ø¤Ø§Ù„.")

    async def handle_assessment_answer(self, query, context, data):
        """Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±"""
        try:
            score = int(data.replace("answer_", ""))
            context.user_data['answers'].append(score)
            context.user_data['question_index'] += 1
            await self.send_assessment_question(query, context)
        except Exception as e:
            logger.error(f"âŒ Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©: {e}")
            await query.edit_message_text("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©.")

    async def complete_assessment(self, query, context):
        """Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± ÙˆØ¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬"""
        try:
            assessment_type = context.user_data['current_assessment']
            answers = context.user_data['answers']
            total_score = sum(answers)

            # ØªØ­Ø¯ÙŠØ¯ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø´Ø¯Ø©
            if assessment_type == 'phq9':
                if total_score <= 4:
                    severity = "Ø·Ø¨ÙŠØ¹ÙŠ"
                    severity_desc = "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù„Ø§Ù…Ø§Øª Ø§ÙƒØªØ¦Ø§Ø¨"
                    color = "ğŸŸ¢"
                elif total_score <= 9:
                    severity = "Ø®ÙÙŠÙ"
                    severity_desc = "Ø§ÙƒØªØ¦Ø§Ø¨ Ø®ÙÙŠÙ"
                    color = "ğŸŸ¡"
                elif total_score <= 14:
                    severity = "Ù…ØªÙˆØ³Ø·"
                    severity_desc = "Ø§ÙƒØªØ¦Ø§Ø¨ Ù…ØªÙˆØ³Ø·"
                    color = "ğŸŸ "
                elif total_score <= 19:
                    severity = "Ù…ØªÙˆØ³Ø· Ø¥Ù„Ù‰ Ø´Ø¯ÙŠØ¯"
                    severity_desc = "Ø§ÙƒØªØ¦Ø§Ø¨ Ù…ØªÙˆØ³Ø· Ø¥Ù„Ù‰ Ø´Ø¯ÙŠØ¯"
                    color = "ğŸ”´"
                else:
                    severity = "Ø´Ø¯ÙŠØ¯"
                    severity_desc = "Ø§ÙƒØªØ¦Ø§Ø¨ Ø´Ø¯ÙŠØ¯"
                    color = "ğŸ”´"
            else:  # GAD-7
                if total_score <= 4:
                    severity = "Ø·Ø¨ÙŠØ¹ÙŠ"
                    severity_desc = "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù„Ø§Ù…Ø§Øª Ù‚Ù„Ù‚"
                    color = "ğŸŸ¢"
                elif total_score <= 9:
                    severity = "Ø®ÙÙŠÙ"
                    severity_desc = "Ù‚Ù„Ù‚ Ø®ÙÙŠÙ"
                    color = "ğŸŸ¡"
                elif total_score <= 14:
                    severity = "Ù…ØªÙˆØ³Ø·"
                    severity_desc = "Ù‚Ù„Ù‚ Ù…ØªÙˆØ³Ø·"
                    color = "ğŸŸ "
                else:
                    severity = "Ø´Ø¯ÙŠØ¯"
                    severity_desc = "Ù‚Ù„Ù‚ Ø´Ø¯ÙŠØ¯"
                    color = "ğŸ”´"

            # Ø­ÙØ¸ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
            self.save_assessment_results(query.from_user.id, assessment_type, answers, total_score, severity)

            # Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù†Øµ
            assessment = PSYCHOLOGICAL_ASSESSMENTS[assessment_type]
            results_text = f"""
{assessment['icon']} **Ù†ØªØ§Ø¦Ø¬ {assessment['name']}**

ğŸ“Š **Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©:** {total_score}
{color} **Ø§Ù„ØªÙ‚ÙŠÙŠÙ…:** {severity_desc}

ğŸ“‹ **Ø§Ù„ØªÙØ³ÙŠØ±:**
{self.get_assessment_interpretation(assessment_type, severity)}

ğŸ’¡ **Ø§Ù„ØªÙˆØµÙŠØ§Øª:**
{self.get_assessment_recommendations(assessment_type, severity)}

âš ï¸ **Ù…Ù„Ø§Ø­Ø¸Ø© Ù…Ù‡Ù…Ø©:** Ù‡Ø°Ø§ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ù„Ø£ØºØ±Ø§Ø¶ Ø§Ù„ØªÙˆØ¹ÙŠØ© ÙÙ‚Ø· ÙˆÙ„ÙŠØ³ Ø¨Ø¯ÙŠÙ„Ø§Ù‹ Ø¹Ù† Ø§Ù„ØªØ´Ø®ÙŠØµ Ø§Ù„Ø·Ø¨ÙŠ Ø§Ù„Ù…ØªØ®ØµØµ.

ğŸ”’ **Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù…Ø­Ù…ÙŠØ© ÙˆÙ…Ø´ÙØ±Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„**
            """

            keyboard = [
                [InlineKeyboardButton("ğŸ§  ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø´Ø®ØµÙŠØ© MBTI", callback_data="start_mbti")],
                [InlineKeyboardButton("ğŸ” Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†ÙØ³ÙŠ Ø§Ù„Ø´Ø§Ù…Ù„", callback_data="start_psychological_evaluation")],
                [InlineKeyboardButton("ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±", callback_data=f"assessment_{assessment_type}")],
                [InlineKeyboardButton("ğŸ  Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©", callback_data="back_to_main")]
            ]

            await query.edit_message_text(
                results_text,
                reply_markup=InlineKeyboardMarkup(keyboard),
                parse_mode='Markdown'
            )
        except Exception as e:
            logger.error(f"âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±: {e}")
            await query.edit_message_text("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬.")

    def get_assessment_interpretation(self, assessment_type, severity):
        """Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ØªÙØ³ÙŠØ± Ø§Ù„Ù†ØªÙŠØ¬Ø©"""
        interpretations = {
            'phq9': {
                'Ø·Ø¨ÙŠØ¹ÙŠ': 'Ù†ØªÙŠØ¬Ø© Ù…Ù…ØªØ§Ø²Ø©! Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù„Ø§Ù…Ø§Øª Ù„Ù„Ø§ÙƒØªØ¦Ø§Ø¨. Ø§Ø³ØªÙ…Ø± ÙÙŠ Ø§Ù„Ø¹Ù†Ø§ÙŠØ© Ø¨ØµØ­ØªÙƒ Ø§Ù„Ù†ÙØ³ÙŠØ©.',
                'Ø®ÙÙŠÙ': 'Ù‚Ø¯ ØªÙˆØ§Ø¬Ù‡ Ø¨Ø¹Ø¶ Ø£Ø¹Ø±Ø§Ø¶ Ø§Ù„Ø§ÙƒØªØ¦Ø§Ø¨ Ø§Ù„Ø®ÙÙŠÙ. ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ­Ø³Ù† Ø¨Ø§Ù„Ø±Ø¹Ø§ÙŠØ© Ø§Ù„Ø°Ø§ØªÙŠØ© ÙˆØ§Ù„Ø¯Ø¹Ù….',
                'Ù…ØªÙˆØ³Ø·': 'ØªÙˆØ¬Ø¯ Ø£Ø¹Ø±Ø§Ø¶ Ø§ÙƒØªØ¦Ø§Ø¨ Ù…ØªÙˆØ³Ø·Ø© ØªØªØ·Ù„Ø¨ Ø§Ù†ØªØ¨Ø§Ù‡Ø§Ù‹. ÙÙƒØ± ÙÙŠ Ø·Ù„Ø¨ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ù…Ù‡Ù†ÙŠØ©.',
                'Ù…ØªÙˆØ³Ø· Ø¥Ù„Ù‰ Ø´Ø¯ÙŠØ¯': 'Ø£Ø¹Ø±Ø§Ø¶ Ø§ÙƒØªØ¦Ø§Ø¨ ÙƒØ¨ÙŠØ±Ø© ØªØ¤Ø«Ø± Ø¹Ù„Ù‰ Ø­ÙŠØ§ØªÙƒ. Ù†Ù†ØµØ­ Ø¨Ù‚ÙˆØ© Ø¨Ø·Ù„Ø¨ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ù…ØªØ®ØµØµØ©.',
                'Ø´Ø¯ÙŠØ¯': 'Ø£Ø¹Ø±Ø§Ø¶ Ø§ÙƒØªØ¦Ø§Ø¨ Ø´Ø¯ÙŠØ¯Ø© ØªØªØ·Ù„Ø¨ ØªØ¯Ø®Ù„Ø§Ù‹ Ø¹Ø§Ø¬Ù„Ø§Ù‹. ÙŠØ±Ø¬Ù‰ Ø·Ù„Ø¨ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ø·Ø¨ÙŠØ© ÙÙˆØ±Ø§Ù‹.'
            },
            'gad7': {
                'Ø·Ø¨ÙŠØ¹ÙŠ': 'Ù†ØªÙŠØ¬Ø© Ù…Ù…ØªØ§Ø²Ø©! Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù„Ø§Ù…Ø§Øª Ù„Ù„Ù‚Ù„Ù‚ Ø§Ù„Ù…ÙØ±Ø·. Ø§Ø³ØªÙ…Ø± ÙÙŠ Ù…Ù…Ø§Ø±Ø³Ø§ØªÙƒ Ø§Ù„ØµØ­ÙŠØ©.',
                'Ø®ÙÙŠÙ': 'Ù‚Ø¯ ØªÙˆØ§Ø¬Ù‡ Ø¨Ø¹Ø¶ Ø§Ù„Ù‚Ù„Ù‚ Ø§Ù„Ø®ÙÙŠÙ. ØªÙ‚Ù†ÙŠØ§Øª Ø§Ù„Ø§Ø³ØªØ±Ø®Ø§Ø¡ ÙŠÙ…ÙƒÙ† Ø£Ù† ØªØ³Ø§Ø¹Ø¯.',
                'Ù…ØªÙˆØ³Ø·': 'ØªÙˆØ¬Ø¯ Ø£Ø¹Ø±Ø§Ø¶ Ù‚Ù„Ù‚ Ù…ØªÙˆØ³Ø·Ø©. ÙÙƒØ± ÙÙŠ ØªØ¹Ù„Ù… Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‚Ù„Ù‚.',
                'Ø´Ø¯ÙŠØ¯': 'Ø£Ø¹Ø±Ø§Ø¶ Ù‚Ù„Ù‚ Ø´Ø¯ÙŠØ¯Ø© ØªØ¤Ø«Ø± Ø¹Ù„Ù‰ Ø­ÙŠØ§ØªÙƒ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©. Ù†Ù†ØµØ­ Ø¨Ø·Ù„Ø¨ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ù…ØªØ®ØµØµØ©.'
            }
        }
        return interpretations.get(assessment_type, {}).get(severity, "Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªÙØ³ÙŠØ± Ù…ØªØ§Ø­")

    def get_assessment_recommendations(self, assessment_type, severity):
        """Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ØªÙˆØµÙŠØ§Øª"""
        recommendations = {
            'phq9': {
                'Ø·Ø¨ÙŠØ¹ÙŠ': 'â€¢ Ø­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ù†Ù…Ø· Ø­ÙŠØ§Ø© ØµØ­ÙŠ\nâ€¢ Ù…Ø§Ø±Ø³ Ø§Ù„Ø±ÙŠØ§Ø¶Ø© Ø¨Ø§Ù†ØªØ¸Ø§Ù…\nâ€¢ Ø­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ø¹Ù„Ø§Ù‚Ø§Øª Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ© Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ©',
                'Ø®ÙÙŠÙ': 'â€¢ Ø§Ù‡ØªÙ… Ø¨Ø§Ù„Ù†ÙˆÙ… Ø§Ù„ÙƒØ§ÙÙŠ\nâ€¢ Ù…Ø§Ø±Ø³ Ø£Ù†Ø´Ø·Ø© ØªØ¬Ù„Ø¨ Ø§Ù„Ø³Ø¹Ø§Ø¯Ø©\nâ€¢ ØªØ­Ø¯Ø« Ù…Ø¹ Ø£Ø´Ø®Ø§Øµ ØªØ«Ù‚ Ø¨Ù‡Ù…',
                'Ù…ØªÙˆØ³Ø·': 'â€¢ ÙÙƒØ± ÙÙŠ Ø§Ù„Ø¹Ù„Ø§Ø¬ Ø§Ù„Ù†ÙØ³ÙŠ\nâ€¢ ØªØ¬Ù†Ø¨ Ø§Ù„ÙƒØ­ÙˆÙ„ ÙˆØ§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ù…Ø¶Ø±Ø©\nâ€¢ Ø­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ø±ÙˆØªÙŠÙ† ÙŠÙˆÙ…ÙŠ Ù…Ù†ØªØ¸Ù…',
                'Ù…ØªÙˆØ³Ø· Ø¥Ù„Ù‰ Ø´Ø¯ÙŠØ¯': 'â€¢ Ø§Ø·Ù„Ø¨ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ù…Ù‡Ù†ÙŠØ© ÙÙˆØ±Ø§Ù‹\nâ€¢ ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø®Ø· Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ù†ÙØ³ÙŠØ©\nâ€¢ Ù„Ø§ ØªØªØ±Ø¯Ø¯ ÙÙŠ Ø·Ù„Ø¨ Ø§Ù„Ø¯Ø¹Ù…',
                'Ø´Ø¯ÙŠØ¯': 'â€¢ Ø§ØªØµÙ„ Ø¨Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø·ÙˆØ§Ø±Ø¦ Ø§Ù„Ù†ÙØ³ÙŠØ©\nâ€¢ ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø·Ø¨ÙŠØ¨ Ù†ÙØ³ÙŠ\nâ€¢ ØªØ¬Ù†Ø¨ Ø§Ù„Ø¨Ù‚Ø§Ø¡ ÙˆØ­ÙŠØ¯Ø§Ù‹'
            },
            'gad7': {
                'Ø·Ø¨ÙŠØ¹ÙŠ': 'â€¢ Ø§Ø³ØªÙ…Ø± ÙÙŠ Ù…Ù…Ø§Ø±Ø³Ø© ØªÙ‚Ù†ÙŠØ§Øª Ø§Ù„Ø§Ø³ØªØ±Ø®Ø§Ø¡\nâ€¢ Ø­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ø§Ù„ØªÙˆØ§Ø²Ù† ÙÙŠ Ø§Ù„Ø­ÙŠØ§Ø©\nâ€¢ Ù…Ø§Ø±Ø³ Ø§Ù„Ø£Ù†Ø´Ø·Ø© Ø§Ù„Ù…Ù…ØªØ¹Ø©',
                'Ø®ÙÙŠÙ': 'â€¢ ØªØ¹Ù„Ù… ØªÙ‚Ù†ÙŠØ§Øª Ø§Ù„ØªÙ†ÙØ³ Ø§Ù„Ø¹Ù…ÙŠÙ‚\nâ€¢ Ù…Ø§Ø±Ø³ Ø§Ù„ØªØ£Ù…Ù„ Ø£Ùˆ Ø§Ù„ÙŠÙˆØºØ§\nâ€¢ Ù‚Ù„Ù„ Ù…Ù† Ø§Ù„ÙƒØ§ÙÙŠÙŠÙ†',
                'Ù…ØªÙˆØ³Ø·': 'â€¢ ÙÙƒØ± ÙÙŠ Ø§Ù„Ø¹Ù„Ø§Ø¬ Ø§Ù„Ù…Ø¹Ø±ÙÙŠ Ø§Ù„Ø³Ù„ÙˆÙƒÙŠ\nâ€¢ Ù…Ø§Ø±Ø³ Ø§Ù„Ø±ÙŠØ§Ø¶Ø© Ø¨Ø§Ù†ØªØ¸Ø§Ù…\nâ€¢ ØªØ¬Ù†Ø¨ Ø§Ù„Ù…ÙˆØ§Ù‚Ù Ø§Ù„Ù…Ø«ÙŠØ±Ø© Ù„Ù„Ù‚Ù„Ù‚',
                'Ø´Ø¯ÙŠØ¯': 'â€¢ Ø§Ø·Ù„Ø¨ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ù…Ù‡Ù†ÙŠØ©\nâ€¢ ÙÙƒØ± ÙÙŠ Ø§Ù„Ø¹Ù„Ø§Ø¬ Ø§Ù„Ø¯ÙˆØ§Ø¦ÙŠ ØªØ­Øª Ø¥Ø´Ø±Ø§Ù Ø·Ø¨ÙŠ\nâ€¢ Ø§Ø·Ù„Ø¨ Ø§Ù„Ø¯Ø¹Ù… Ù…Ù† Ø§Ù„Ø£Ù‡Ù„ ÙˆØ§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡'
            }
        }
        return recommendations.get(assessment_type, {}).get(severity, "Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙˆØµÙŠØ§Øª Ù…ØªØ§Ø­Ø©")

    async def show_mbti_detailed_info(self, query, context):
        """Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ØªÙØµÙŠÙ„ÙŠØ© Ø¹Ù† MBTI"""
        try:
            info_text = """
ğŸ§  **Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ØªÙØµÙŠÙ„ÙŠØ© Ø¹Ù† Ø§Ø®ØªØ¨Ø§Ø± MBTI**

ğŸ“š **Ù†Ø¨Ø°Ø© ØªØ§Ø±ÙŠØ®ÙŠØ©:**
ØªÙ… ØªØ·ÙˆÙŠØ± Ù…Ø¤Ø´Ø± Ù…Ø§ÙŠØ±Ø²-Ø¨Ø±ÙŠØºØ² Ù„Ù„Ø£Ù†Ù…Ø§Ø· Ø¹Ù„Ù‰ ÙŠØ¯ ÙƒØ§Ø«Ø§Ø±ÙŠÙ† Ø¨Ø±ÙŠØºØ² ÙˆØ§Ø¨Ù†ØªÙ‡Ø§ Ø¥ÙŠØ²Ø§Ø¨ÙŠÙ„ Ù…Ø§ÙŠØ±Ø²ØŒ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù†Ø¸Ø±ÙŠØ§Øª ÙƒØ§Ø±Ù„ ÙŠÙˆÙ†Øº ÙÙŠ Ø¹Ù„Ù… Ø§Ù„Ù†ÙØ³.

ğŸ¯ **Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ Ø§Ù„Ø£Ø±Ø¨Ø¹Ø©:**

**1. Ø§Ù„Ø·Ø§Ù‚Ø© (E/I):**
â€¢ Ø§Ù„Ø§Ù†Ø¨Ø³Ø§Ø· (E): ÙŠØ³ØªÙ…Ø¯ Ø§Ù„Ø·Ø§Ù‚Ø© Ù…Ù† Ø§Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†
â€¢ Ø§Ù„Ø§Ù†Ø·ÙˆØ§Ø¡ (I): ÙŠØ³ØªÙ…Ø¯ Ø§Ù„Ø·Ø§Ù‚Ø© Ù…Ù† Ø§Ù„ØªØ£Ù…Ù„ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ

**2. Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª (S/N):**
â€¢ Ø§Ù„Ø­Ø³ (S): ÙŠØ±ÙƒØ² Ø¹Ù„Ù‰ Ø§Ù„Ø­Ù‚Ø§Ø¦Ù‚ ÙˆØ§Ù„ØªÙØ§ØµÙŠÙ„
â€¢ Ø§Ù„Ø­Ø¯Ø³ (N): ÙŠØ±ÙƒØ² Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù†Ù…Ø§Ø· ÙˆØ§Ù„Ø¥Ù…ÙƒØ§Ù†ÙŠØ§Øª

**3. Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª (T/F):**
â€¢ Ø§Ù„ØªÙÙƒÙŠØ± (T): ÙŠØªØ®Ø° Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†Ø·Ù‚
â€¢ Ø§Ù„Ù…Ø´Ø§Ø¹Ø± (F): ÙŠØªØ®Ø° Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù‚ÙŠÙ…

**4. Ø§Ù„Ù†Ù…Ø· (J/P):**
â€¢ Ø§Ù„Ø­Ø²Ù… (J): ÙŠÙØ¶Ù„ Ø§Ù„Ø¨Ù†ÙŠØ© ÙˆØ§Ù„ØªØ®Ø·ÙŠØ·
â€¢ Ø§Ù„Ù…Ø±ÙˆÙ†Ø© (P): ÙŠÙØ¶Ù„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ© ÙˆØ§Ù„Ù…Ø±ÙˆÙ†Ø©

ğŸŒŸ **16 Ù†Ù…Ø· Ø´Ø®ØµÙŠØ© Ù…Ø®ØªÙ„Ù**
ÙƒÙ„ Ù…Ø²ÙŠØ¬ Ù…Ù† Ù‡Ø°Ù‡ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ ÙŠÙ†ØªØ¬ Ù†Ù…Ø·Ø§Ù‹ ÙØ±ÙŠØ¯Ø§Ù‹ Ø¨Ø®ØµØ§Ø¦ØµÙ‡ Ø§Ù„Ù…Ù…ÙŠØ²Ø©.
            """

            keyboard = [
                [InlineKeyboardButton("ğŸš€ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±", callback_data="mbti_start_test")],
                [InlineKeyboardButton("ğŸ”™ Ø§Ù„Ø¹ÙˆØ¯Ø©", callback_data="start_mbti")]
            ]

            await query.edit_message_text(
                info_text,
                reply_markup=InlineKeyboardMarkup(keyboard),
                parse_mode='Markdown'
            )
        except Exception as e:
            logger.error(f"âŒ Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª MBTI: {e}")

    async def show_psychological_detailed_info(self, query, context):
        """Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ØªÙØµÙŠÙ„ÙŠØ© Ø¹Ù† Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†ÙØ³ÙŠ"""
        try:
            info_text = """
ğŸ” **Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ØªÙØµÙŠÙ„ÙŠØ© Ø¹Ù† Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†ÙØ³ÙŠ Ø§Ù„Ø´Ø§Ù…Ù„**

ğŸ“‹ **Ù…Ø§ Ù‡Ùˆ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†ÙØ³ÙŠØŸ**
Ù‡Ùˆ ÙØ­Øµ Ù…Ù†Ù‡Ø¬ÙŠ ÙˆØ´Ø§Ù…Ù„ Ù„Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù†ÙØ³ÙŠØ© ÙˆØ§Ù„Ø¹Ù‚Ù„ÙŠØ© Ù„Ù„Ø´Ø®ØµØŒ ÙŠÙ‡Ø¯Ù Ø¥Ù„Ù‰ ÙÙ‡Ù… Ù†Ù‚Ø§Ø· Ø§Ù„Ù‚ÙˆØ© ÙˆØ§Ù„Ø¶Ø¹Ù ÙˆØªØ­Ø¯ÙŠØ¯ Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ø¯Ø¹Ù….

ğŸ¯ **Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„ØªÙ‚ÙŠÙŠÙ…:**

**1. Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ø¨ÙŠ:**
â€¢ Ø§Ù„Ø£Ù…Ø±Ø§Ø¶ Ø§Ù„Ø¬Ø³Ø¯ÙŠØ© ÙˆØ§Ù„Ù†ÙØ³ÙŠØ© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
â€¢ Ø§Ù„Ø£Ø¯ÙˆÙŠØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©
â€¢ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¹Ø§Ø¦Ù„ÙŠ Ù„Ù„Ø§Ø¶Ø·Ø±Ø§Ø¨Ø§Øª Ø§Ù„Ù†ÙØ³ÙŠØ©

**2. Ø§Ù„Ø¨ÙŠØ¦Ø© Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©:**
â€¢ Ø¬ÙˆØ¯Ø© Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª Ø§Ù„Ø£Ø³Ø±ÙŠØ©
â€¢ Ø´Ø¨ÙƒØ© Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ
â€¢ Ø§Ù„Ø¶ØºÙˆØ· Ø§Ù„Ø¨ÙŠØ¦ÙŠØ© ÙˆØ§Ù„Ù…Ù‡Ù†ÙŠØ©

**3. Ø§Ù„Ø³Ù„ÙˆÙƒÙŠØ§Øª ÙˆØ§Ù„Ø¹Ø§Ø¯Ø§Øª:**
â€¢ Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø³Ù„ÙˆÙƒ Ø§Ù„ØµØ­ÙŠ Ø£Ùˆ Ø§Ù„Ø¶Ø§Ø±
â€¢ Ø¢Ù„ÙŠØ§Øª Ø§Ù„ØªØ£Ù‚Ù„Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©
â€¢ Ø§Ù„Ø³Ù„ÙˆÙƒÙŠØ§Øª Ø§Ù„Ø¥Ø¯Ù…Ø§Ù†ÙŠØ© Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø©

**4. Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù†ÙØ³ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©:**
â€¢ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªÙˆØªØ± ÙˆØ§Ù„Ù‚Ù„Ù‚
â€¢ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø²Ø§Ø¬ÙŠØ© Ø§Ù„Ø¹Ø§Ù…Ø©
â€¢ Ø§Ù„Ù‚Ø¯Ø±Ø© Ø¹Ù„Ù‰ Ø§Ù„ØªØ£Ù‚Ù„Ù… ÙˆØ§Ù„ØµÙ…ÙˆØ¯

ğŸ“Š **Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…:**
â€¢ ØªØ­Ù„ÙŠÙ„ Ø´Ø§Ù…Ù„ Ù„Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù†ÙØ³ÙŠØ©
â€¢ ØªØ­Ø¯ÙŠØ¯ Ø¹ÙˆØ§Ù…Ù„ Ø§Ù„Ø®Ø·Ø± ÙˆØ§Ù„Ø­Ù…Ø§ÙŠØ©
â€¢ ØªÙˆØµÙŠØ§Øª Ù…Ø®ØµØµØ© Ù„Ù„ØªØ­Ø³Ù†
â€¢ Ø¥Ø±Ø´Ø§Ø¯Ø§Øª Ù„Ù„Ø¯Ø¹Ù… Ø§Ù„Ø±ÙˆØ­ÙŠ ÙˆØ§Ù„ÙÙ„Ø³ÙÙŠ

ğŸ”’ **Ø§Ù„Ø³Ø±ÙŠØ© ÙˆØ§Ù„Ø®ØµÙˆØµÙŠØ©:**
Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…Ø´ÙØ±Ø© ÙˆÙ…Ø­Ù…ÙŠØ©ØŒ ÙˆÙ„Ø§ ÙŠØªÙ… Ù…Ø´Ø§Ø±ÙƒØªÙ‡Ø§ Ù…Ø¹ Ø£ÙŠ Ø·Ø±Ù Ø«Ø§Ù„Ø«.
            """

            keyboard = [
                [InlineKeyboardButton("ğŸš€ Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…", callback_data="psych_start_evaluation")],
                [InlineKeyboardButton("ğŸ”™ Ø§Ù„Ø¹ÙˆØ¯Ø©", callback_data="start_psychological_evaluation")]
            ]

            await query.edit_message_text(
                info_text,
                reply_markup=InlineKeyboardMarkup(keyboard),
                parse_mode='Markdown'
            )
        except Exception as e:
            logger.error(f"âŒ Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†ÙØ³ÙŠ: {e}")

    async def show_detailed_info(self, query, context):
        """Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…ÙØµÙ„Ø© Ø¹Ù† Ø§Ù„Ø®Ø¯Ù…Ø©"""
        try:
            info_text = """
â„¹ï¸ **Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…ÙØµÙ„Ø© Ø¹Ù† Ù…Ø±ÙƒØ² Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†ÙØ³ÙŠ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„**

ğŸ¯ **Ø±Ø³Ø§Ù„ØªÙ†Ø§:**
ØªÙ‚Ø¯ÙŠÙ… Ø®Ø¯Ù…Ø§Øª ØªØ­Ù„ÙŠÙ„ Ù†ÙØ³ÙŠ Ø´Ø§Ù…Ù„Ø© ØªØ¬Ù…Ø¹ Ø¨ÙŠÙ† Ø§Ù„Ø¹Ù„Ù… Ø§Ù„Ø­Ø¯ÙŠØ« ÙˆØ§Ù„Ø¥Ø±Ø´Ø§Ø¯ Ø§Ù„Ø±ÙˆØ­ÙŠ Ù„Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ Ø¹Ù„Ù‰ ÙÙ‡Ù… Ø°Ø§ØªÙƒ Ø¨Ø¹Ù…Ù‚ ÙˆØªØ·ÙˆÙŠØ± Ø¥Ù…ÙƒØ§Ù†Ø§ØªÙƒ.

ğŸ”¬ **Ø®Ø¯Ù…Ø§ØªÙ†Ø§ Ø§Ù„Ø¹Ù„Ù…ÙŠØ©:**

ğŸ§  **ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø´Ø®ØµÙŠØ© MBTI:**
â€¢ Ù…Ø¤Ø´Ø± Ù…Ø§ÙŠØ±Ø²-Ø¨Ø±ÙŠØºØ² Ø§Ù„Ù…Ø¹ØªÙ…Ø¯ Ø¹Ø§Ù„Ù…ÙŠØ§Ù‹
â€¢ Ù…ØµØ¯Ø§Ù‚ÙŠØ© 85% ÙÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„
â€¢ 16 Ù†Ù…Ø· Ø´Ø®ØµÙŠØ© Ù…Ø®ØªÙ„Ù
â€¢ ØªÙˆØ¬ÙŠÙ‡Ø§Øª Ù…Ù‡Ù†ÙŠØ© Ù…ØªØ®ØµØµØ©

ğŸ“Š **Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø©:**
â€¢ PHQ-9 Ù„Ù„Ø§ÙƒØªØ¦Ø§Ø¨
â€¢ GAD-7 Ù„Ù„Ù‚Ù„Ù‚
â€¢ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†ÙØ³ÙŠ Ø§Ù„Ø´Ø§Ù…Ù„

ğŸ•Œ **Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„Ø±ÙˆØ­ÙŠ:**
â€¢ Ø¢ÙŠØ§Øª Ù‚Ø±Ø¢Ù†ÙŠØ© Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ø­Ø§Ù„ØªÙƒ
â€¢ Ø£Ø­Ø§Ø¯ÙŠØ« Ù†Ø¨ÙˆÙŠØ© Ø´Ø±ÙŠÙØ©
â€¢ ØªÙØ³ÙŠØ±Ø§Øª ÙˆØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø¹Ù…Ù„ÙŠØ©

ğŸ“š **Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ„Ø³ÙÙŠ:**
â€¢ Ø­ÙƒÙ… Ù…Ù† Ù…Ø®ØªÙ„Ù Ø§Ù„Ù…Ø¯Ø§Ø±Ø³ Ø§Ù„ÙÙ„Ø³ÙÙŠØ©
â€¢ ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø¹Ù…Ù„ÙŠØ© Ù„Ù„Ø­ÙƒÙ…Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
â€¢ Ø¯Ø¹Ù… Ù…Ù† Ø§Ù„ÙÙ„Ø³ÙØ© Ø§Ù„Ø­Ø¯ÙŠØ«Ø©

ğŸ”’ **Ø§Ù„Ø®ØµÙˆØµÙŠØ© ÙˆØ§Ù„Ø£Ù…Ø§Ù†:**
â€¢ ØªØ´ÙÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨ØªÙ‚Ù†ÙŠØ© SHA-256
â€¢ Ø¥Ø®ÙØ§Ø¡ ÙƒØ§Ù…Ù„ Ù„Ù„Ù‡ÙˆÙŠØ©
â€¢ Ù„Ø§ Ù†Ø´Ø§Ø±Ùƒ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…Ø¹ Ø£ÙŠ Ø·Ø±Ù Ø«Ø§Ù„Ø«
â€¢ ÙŠÙ…ÙƒÙ†Ùƒ Ø­Ø°Ù Ø¨ÙŠØ§Ù†Ø§ØªÙƒ ÙÙŠ Ø£ÙŠ ÙˆÙ‚Øª

âš ï¸ **ØªÙ†Ø¨ÙŠÙ‡ Ù…Ù‡Ù…:**
Ø®Ø¯Ù…Ø§ØªÙ†Ø§ Ù„Ù„ØªÙˆØ¹ÙŠØ© ÙˆØ§Ù„Ø¯Ø¹Ù… Ø§Ù„Ù†ÙØ³ÙŠØŒ ÙˆÙ„ÙŠØ³Øª Ø¨Ø¯ÙŠÙ„Ø§Ù‹ Ø¹Ù† Ø§Ù„Ø§Ø³ØªØ´Ø§Ø±Ø© Ø§Ù„Ø·Ø¨ÙŠØ© Ø§Ù„Ù…ØªØ®ØµØµØ©.

ğŸŒŸ **ÙØ±ÙŠÙ‚ Ø§Ù„Ø¹Ù…Ù„:**
Ù†Ø­Ù† ÙØ±ÙŠÙ‚ Ù…Ù† Ø§Ù„Ù…ØªØ®ØµØµÙŠÙ† ÙÙŠ Ø¹Ù„Ù… Ø§Ù„Ù†ÙØ³ ÙˆØ§Ù„Ø¥Ø±Ø´Ø§Ø¯ Ø§Ù„Ø¯ÙŠÙ†ÙŠØŒ Ù†Ø¹Ù…Ù„ Ø¹Ù„Ù‰ ØªÙ‚Ø¯ÙŠÙ… Ø£ÙØ¶Ù„ Ø®Ø¯Ù…Ø© Ù…Ù…ÙƒÙ†Ø©.
            """

            keyboard = [
                [InlineKeyboardButton("ğŸ§  ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø´Ø®ØµÙŠØ© MBTI", callback_data="start_mbti")],
                [InlineKeyboardButton("ğŸ“Š Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù†ÙØ³ÙŠØ©", callback_data="start_journey")],
                [InlineKeyboardButton("ğŸ” Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†ÙØ³ÙŠ Ø§Ù„Ø´Ø§Ù…Ù„", callback_data="start_psychological_evaluation")],
                [InlineKeyboardButton("ğŸ  Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©", callback_data="back_to_main")]
            ]

            await query.edit_message_text(
                info_text,
                reply_markup=InlineKeyboardMarkup(keyboard),
                parse_mode='Markdown'
            )
        except Exception as e:
            logger.error(f"âŒ Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ÙØµÙ„Ø©: {e}")

    async def start_command_from_callback(self, query, context):
        """ØªØ´ØºÙŠÙ„ Ø£Ù…Ø± Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ù…Ù† callback"""
        try:
            user = query.from_user

            welcome_text = f"""
ğŸŒŸ **Ø£Ù‡Ù„Ø§Ù‹ ÙˆØ³Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ {user.first_name}** ğŸŒŸ

ğŸ§  **Ù…Ø±ÙƒØ² Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†ÙØ³ÙŠ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„** ğŸ§ 

âœ¨ **Ø®Ø¯Ù…Ø§ØªÙ†Ø§ Ø§Ù„Ø´Ø§Ù…Ù„Ø©:**

ğŸ¯ **ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø´Ø®ØµÙŠØ© MBTI**
â€¢ Ø§ÙƒØªØ´Ù Ù†Ù…Ø· Ø´Ø®ØµÙŠØªÙƒ Ù…Ù† 16 Ù†Ù…Ø· Ù…Ø®ØªÙ„Ù

ğŸ“Š **Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø©**
â€¢ Ù…Ù‚ÙŠØ§Ø³ Ø§Ù„Ø§ÙƒØªØ¦Ø§Ø¨ PHQ-9
â€¢ Ù…Ù‚ÙŠØ§Ø³ Ø§Ù„Ù‚Ù„Ù‚ GAD-7

ğŸ” **Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†ÙØ³ÙŠ Ø§Ù„Ø´Ø§Ù…Ù„**
â€¢ ØªØ­Ù„ÙŠÙ„ Ù…ØªÙƒØ§Ù…Ù„ Ù„Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù†ÙØ³ÙŠØ©
â€¢ Ø¯Ø¹Ù… Ø¯ÙŠÙ†ÙŠ ÙˆÙÙ„Ø³ÙÙŠ Ù…Ø®ØµØµ

ğŸš€ **Ø§Ø¨Ø¯Ø£ Ø±Ø­Ù„ØªÙƒ Ù†Ø­Ùˆ ÙÙ‡Ù… Ø£Ø¹Ù…Ù‚ Ù„Ø°Ø§ØªÙƒ!**
            """

            keyboard = [
                [InlineKeyboardButton("ğŸ§  ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø´Ø®ØµÙŠØ© MBTI", callback_data="start_mbti")],
                [InlineKeyboardButton("ğŸ“Š Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù†ÙØ³ÙŠØ©", callback_data="start_journey")],
                [InlineKeyboardButton("ğŸ” Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†ÙØ³ÙŠ Ø§Ù„Ø´Ø§Ù…Ù„", callback_data="start_psychological_evaluation")],
                [InlineKeyboardButton("â„¹ï¸ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø®Ø¯Ù…Ø©", callback_data="more_info")]
            ]

            await query.edit_message_text(
                welcome_text, 
                reply_markup=InlineKeyboardMarkup(keyboard),
                parse_mode='Markdown'
            )
        except Exception as e:
            logger.error(f"âŒ Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©: {e}")

    async def handle_text_message(self, update: Update, context: ContextTypes.DEFAULT_TYPE):
        """Ù…Ø¹Ø§Ù„Ø¬ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù†ØµÙŠØ©"""
        try:
            # ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ø§Ù„Ø¬Ø© Ù„Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù†ØµÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ø¬Ø©
            # Ù…Ø«Ù„Ø§Ù‹ØŒ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰ Ø£Ùˆ Ø§Ù„Ø§Ø³ØªÙØ³Ø§Ø±Ø§Øª
            user_text = update.message.text

            # Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†Øµ ÙˆØ§Ù‚ØªØ±Ø§Ø­ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©
            response_text = """
ğŸ’¬ **Ø´ÙƒØ±Ø§Ù‹ Ù„Ø±Ø³Ø§Ù„ØªÙƒ**

Ù„ØªÙ‚Ø¯ÙŠÙ… Ø£ÙØ¶Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ÙƒØŒ ÙŠØ±Ø¬Ù‰ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ© Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø®Ø¯Ù…Ø§ØªÙ†Ø§:

ğŸ§  **ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø´Ø®ØµÙŠØ© MBTI** - Ù„ÙÙ‡Ù… Ù†Ù…Ø· Ø´Ø®ØµÙŠØªÙƒ
ğŸ“Š **Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù†ÙØ³ÙŠØ©** - Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù†ÙØ³ÙŠØ©
ğŸ” **Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†ÙØ³ÙŠ Ø§Ù„Ø´Ø§Ù…Ù„** - Ù„ØªØ­Ù„ÙŠÙ„ Ù…ØªÙƒØ§Ù…Ù„

ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¨Ø¯Ø¡ Ø¨Ø£ÙŠ Ø®Ø¯Ù…Ø© ØªØ´Ø§Ø¡ Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø£Ø¯Ù†Ø§Ù‡:
            """

            keyboard = [
                [InlineKeyboardButton("ğŸ§  ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø´Ø®ØµÙŠØ© MBTI", callback_data="start_mbti")],
                [InlineKeyboardButton("ğŸ“Š Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù†ÙØ³ÙŠØ©", callback_data="start_journey")],
                [InlineKeyboardButton("ğŸ” Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†ÙØ³ÙŠ Ø§Ù„Ø´Ø§Ù…Ù„", callback_data="start_psychological_evaluation")],
                [InlineKeyboardButton("â„¹ï¸ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø®Ø¯Ù…Ø©", callback_data="more_info")]
            ]

            await update.message.reply_text(
                response_text,
                reply_markup=InlineKeyboardMarkup(keyboard),
                parse_mode='Markdown'
            )
        except Exception as e:
            logger.error(f"âŒ Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†ØµÙŠØ©: {e}")

    def save_user_data(self, user):
        """Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…"""
        try:
            conn = sqlite3.connect(self.db.db_path)
            cursor = conn.cursor()

            cursor.execute('''
            INSERT OR REPLACE INTO users 
            (user_id, username, first_name, last_interaction)
            VALUES (?, ?, ?, ?)
            ''', (user.id, user.username, user.first_name, datetime.now()))

            conn.commit()
            conn.close()
            logger.info(f"âœ… ØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: {user.id}")
        except Exception as e:
            logger.error(f"âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: {e}")

    def save_mbti_results(self, user_id, session_id, analysis):
        """Ø­ÙØ¸ Ù†ØªØ§Ø¦Ø¬ MBTI"""
        try:
            conn = sqlite3.connect(self.db.db_path)
            cursor = conn.cursor()

            cursor.execute('''
            INSERT INTO mbti_results 
            (user_id, session_id, personality_type, dimension_scores, detailed_analysis)
            VALUES (?, ?, ?, ?, ?)
            ''', (
                user_id, session_id, analysis['personality_type'],
                json.dumps(analysis['dimension_scores']),
                json.dumps(analysis['details'])
            ))

            conn.commit()
            conn.close()
            logger.info(f"âœ… ØªÙ… Ø­ÙØ¸ Ù†ØªØ§Ø¦Ø¬ MBTI Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…: {user_id}")
        except Exception as e:
            logger.error(f"âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ù†ØªØ§Ø¦Ø¬ MBTI: {e}")

    def save_psychological_results(self, user_id, session_id, results):
        """Ø­ÙØ¸ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†ÙØ³ÙŠ"""
        try:
            conn = sqlite3.connect(self.db.db_path)
            cursor = conn.cursor()

            cursor.execute('''
            INSERT INTO psychological_evaluations 
            (user_id, session_id, evaluation_data, analysis_results, support_resources)
            VALUES (?, ?, ?, ?, ?)
            ''', (
                user_id, session_id,
                json.dumps(results['responses']),
                json.dumps(results['analysis']),
                json.dumps({
                    'religious': results['religious_support'],
                    'philosophical': results['philosophical_support']
                })
            ))

            conn.commit()
            conn.close()
            logger.info(f"âœ… ØªÙ… Ø­ÙØ¸ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†ÙØ³ÙŠ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…: {user_id}")
        except Exception as e:
            logger.error(f"âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†ÙØ³ÙŠ: {e}")

    def save_assessment_results(self, user_id, assessment_type, answers, total_score, severity):
        """Ø­ÙØ¸ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù†ÙØ³ÙŠØ©"""
        try:
            conn = sqlite3.connect(self.db.db_path)
            cursor = conn.cursor()

            cursor.execute('''
            INSERT INTO assessments 
            (user_id, assessment_type, questions_answers, total_score, severity, timestamp)
            VALUES (?, ?, ?, ?, ?, ?)
            ''', (
                user_id, assessment_type, json.dumps(answers), 
                total_score, severity, datetime.now()
            ))

            conn.commit()
            conn.close()
            logger.info(f"âœ… ØªÙ… Ø­ÙØ¸ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…: {user_id}")
        except Exception as e:
            logger.error(f"âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…: {e}")

    def log_user_interaction(self, user_id, action):
        """ØªØ³Ø¬ÙŠÙ„ ØªÙØ§Ø¹Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…"""
        try:
            conn = sqlite3.connect(self.db.db_path)
            cursor = conn.cursor()

            cursor.execute('''
            UPDATE users SET last_interaction = ? WHERE user_id = ?
            ''', (datetime.now(), user_id))

            conn.commit()
            conn.close()
        except Exception as e:
            logger.error(f"âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªÙØ§Ø¹Ù„: {e}")

def clear_webhook():
    """Ù…Ø³Ø­ webhook Ù„Ø­Ù„ ØªØ¹Ø§Ø±Ø¶ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ù…ØªØ¹Ø¯Ø¯Ø©"""
    try:
        import requests
        url = f"https://api.telegram.org/bot{TOKEN}/deleteWebhook"
        response = requests.post(url, timeout=10)
        if response.status_code == 200:
            logger.info("ğŸ”§ ØªÙ… Ù…Ø³Ø­ webhook Ø§Ù„Ù‚Ø¯ÙŠÙ…")
        else:
            logger.warning(f"âš ï¸ Ø§Ø³ØªØ¬Ø§Ø¨Ø© ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹Ø© Ù…Ù† webhook: {response.status_code}")
    except Exception as e:
        logger.warning(f"âš ï¸ ØªØ¹Ø°Ø± Ù…Ø³Ø­ webhook: {e}")

def run_bot():
    """ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨ÙˆØª Ù…Ø¹ Ø­Ù„ Ù…Ø´ÙƒÙ„Ø© event loop Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹"""
    try:
        # Ù…Ø³Ø­ webhook Ø§Ù„Ù‚Ø¯ÙŠÙ…
        clear_webhook()

        # Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨ÙˆØª
        bot = AdvancedMentalHealthBot()

        async def main_async():
            """Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ØºÙŠØ± Ø§Ù„Ù…ØªØ²Ø§Ù…Ù†Ø©"""
            try:
                # Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
                application = Application.builder().token(TOKEN).build()

                # Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ø§Ù„Ø¬ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
                async def error_handler(update: object, context: ContextTypes.DEFAULT_TYPE) -> None:
                    logger.error(f"Exception while handling an update: {context.error}")

                application.add_error_handler(error_handler)

                # Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø§Øª
                application.add_handler(CommandHandler("start", bot.start_command))
                application.add_handler(CallbackQueryHandler(bot.handle_callback))
                application.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, bot.handle_text_message))

                # Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
                logger.info("ğŸš€ Ù…Ø±ÙƒØ² Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†ÙØ³ÙŠ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ ÙŠØ¨Ø¯Ø£ Ø§Ù„ØªØ´ØºÙŠÙ„...")
                logger.info("ğŸ§  ØªÙ… ØªØ­Ù…ÙŠÙ„ Ù†Ø¸Ø§Ù… ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø´Ø®ØµÙŠØ© MBTI")
                logger.info("ğŸ“Š ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù†ÙØ³ÙŠØ© Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø©")
                logger.info("ğŸ” ØªÙ… ØªØ­Ù…ÙŠÙ„ Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†ÙØ³ÙŠ Ø§Ù„Ø´Ø§Ù…Ù„")
                logger.info("ğŸ’¾ ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©")
                logger.info("âœ… Ø§Ù„Ø¨ÙˆØª Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¹Ù…Ù„ 24/7!")

                # ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨ÙˆØª
                await application.run_polling(drop_pending_updates=True)

            except Exception as e:
                logger.error(f"âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©: {e}")

        # ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨ÙˆØª
        asyncio.run(main_async())

    except Exception as e:
        logger.error(f"âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨ÙˆØª: {e}")

if __name__ == '__main__':
    try:
        run_bot()
    except KeyboardInterrupt:
        logger.info("ğŸ”´ ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¨ÙˆØª Ø¨ÙˆØ§Ø³Ø·Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…")
    except Exception as e:
        logger.error(f"âŒ Ø®Ø·Ø£ Ù†Ù‡Ø§Ø¦ÙŠ: {e}")
